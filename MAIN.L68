00001AB2 Starting Address
Assembler used: EASy68K Editor/Assembler v5.15.04
Created On: 04/02/2018 20:06:34

00000000                             1  ; =============================================================================
00000000                             2  ; TITLE    : EXAMPLE GAME
00000000                             3  ; AUTHOR   : ANTONI BURGUERA
00000000                             4  ; CREATION : 22-OCT-2017
00000000                             5  ; =============================================================================
00000000                             6  
00001000                             7              ORG     $1000
00001000                             8  
00001000                             9  ; --- CODE INCLUDES -----------------------------------------------------------
00001000                            10  
00001000                            11              INCLUDE "SYSCONST.X68"          ; SYSTEM CONSTANTS
00001000                            12  ; =============================================================================
00001000                            13  ; SYSTEM CONSTANTS
00001000                            14  ; =============================================================================
00001000                            15  
00001000                            16  ; --- TRAP RELATED CONSTANTS --------------------------------------------------
00001000                            17  
00001000  =00000000                 18  KBDTRAP     EQU     0                       ; KEYBOARD UPDATE TRAP
00001000  =00000001                 19  SCRTRAP     EQU     1                       ; SCREEN REFRESH TRAP
00001000                            20  
00001000                            21  ; --- KEY CODES (EASy68K)
00001000                            22  
00001000  =00000020                 23  KBDCHRSP    EQU     $20                     ; SPACE KEY
00001000  =0000004D                 24  KBDCHRMK    EQU     'M'                     ; M KEY
00001000  =00000010                 25  KBDCHRSH    EQU     $10                     ; SHIFT KEY
00001000  =00000050                 26  KBDCHRPK    EQU     'P'                     ; P KEY
00001000  =00000025                 27  KBDCHRLF    EQU     $25                     ; LEFT KEY
00001000  =00000026                 28  KBDCHRUP    EQU     $26                     ; UP KEY
00001000  =00000027                 29  KBDCHRRT    EQU     $27                     ; RIGHT KEY
00001000  =00000028                 30  KBDCHRDN    EQU     $28                     ; DOWN KEY
00001000                            31  
00001000                            32  ; --- KEYBOARD MAPPING --------------------------------------------------------
00001000                            33  
00001000  =00000025                 34  KBDLEFT     EQU     KBDCHRLF                ; LEFT BUTTON
00001000  =00000026                 35  KBDUP       EQU     KBDCHRUP                ; UP BUTTON
00001000  =00000027                 36  KBDRIGHT    EQU     KBDCHRRT                ; RIGHT BUTTON
00001000  =00000028                 37  KBDDOWN     EQU     KBDCHRDN                ; DOWN BUTTON
00001000  =00000020                 38  KBDFIRE1    EQU     KBDCHRSP                ; FIRE 1 BUTTON
00001000  =0000004D                 39  KBDFIRE2    EQU     KBDCHRMK                ; FIRE 2 BUTTON
00001000  =00000010                 40  KBDFIRE3    EQU     KBDCHRSH                ; FIRE 3 BUTTON
00001000  =00000050                 41  KBDPAUSE    EQU     KBDCHRPK                ; PAUSE BUTTON
00001000                            42  
00001000                            43  ; --- KEYBOARD BITFIELD MASKS -------------------------------------------------
00001000                            44  ; CONVENIENCE CONSTANTS TO ACCESS THE FOLLOWING BIT-FIELD.
00001000                            45  ; THIS BIT-FIELD IS USED BY SYSTEM VARS (KBDVAL) AND (KBDEDGE).
00001000                            46  ; +---+---+---+---+---+---+---+---+
00001000                            47  ; | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 |
00001000                            48  ; +---+---+---+---+---+---+---+---+
00001000                            49  ;   |   |   |   |   |   |   |   |
00001000                            50  ;   |   |   |   |   |   |   |   +---------- LEFT BUTTON
00001000                            51  ;   |   |   |   |   |   |   +-------------- UP BUTTON
00001000                            52  ;   |   |   |   |   |   +------------------ RIGHT BUTTON
00001000                            53  ;   |   |   |   |   +---------------------- DOWN BUTTON
00001000                            54  ;   |   |   |   +-------------------------- FIRE 1 BUTTON
00001000                            55  ;   |   |   +------------------------------ FIRE 2 BUTTON
00001000                            56  ;   |   +---------------------------------- FIRE 3 BUTTON
00001000                            57  ;   +-------------------------------------- PAUSE BUTTON
00001000                            58  
00001000  =00000001                 59  KBDMSKLF    EQU     %00000001
00001000  =00000002                 60  KBDMSKUP    EQU     %00000010
00001000  =00000004                 61  KBDMSKRT    EQU     %00000100
00001000  =00000008                 62  KBDMSKDN    EQU     %00001000
00001000  =00000010                 63  KBDMSKF1    EQU     %00010000
00001000  =00000020                 64  KBDMSKF2    EQU     %00100000
00001000  =00000040                 65  KBDMSKF3    EQU     %01000000
00001000  =00000080                 66  KBDMSKPS    EQU     %10000000
00001000                            67  
00001000                            68  ; --- KEYBOARD BITFIELD POSITIONS ---------------------------------------------
00001000                            69  
00001000  =00000000                 70  KBDBITLF    EQU     0
00001000  =00000001                 71  KBDBITUP    EQU     1
00001000  =00000002                 72  KBDBITRT    EQU     2
00001000  =00000003                 73  KBDBITDN    EQU     3
00001000  =00000004                 74  KBDBITF1    EQU     4
00001000  =00000005                 75  KBDBITF2    EQU     5
00001000  =00000006                 76  KBDBITF3    EQU     6
00001000  =00000007                 77  KBDBITPS    EQU     7
00001000                            78  
00001000                            79  ; --- SCREEN RELATED CONSTANTS ------------------------------------------------
00001000                            80  
00001000  =00000280                 81  SCRWIDTH    EQU     640                     ; SCREEN WIDTH (PIXELS)
00001000  =000001E0                 82  SCRHEIGH    EQU     480                     ; SCREEN HEIGHT (PIXELS)
00001000  =00000001                 83  SCRIRQ      EQU     1                       ; SCREEN INTERRUPT NUMBER
00001000  =00000014                 84  SCRTIM      EQU     20                      ; SCREEN TIMER (MS)
00001000                            85  
00001000                            86  ; --- DYNAMIC MEMORY CONSTANTS ------------------------------------------------
00001000                            87  
00001000  =00000040                 88  DMMBSIZE    EQU     64                      ; BLOCK SIZE (BYTES). POWER OF TWO
00001000  =00000032                 89  DMMBNUM     EQU     50                      ; NUMBER OF BLOCKS
00001000  =00000000                 90  DMMSYSID    EQU     0                       ; SYSTEM OWNER ID (MUST BE 0)
00001000  =00000000                 91  -------------------- end include --------------------
00001000                            92              INCLUDE "SYSTEM.X68"            ; SYSTEM CODE
00001000                            93  ; =============================================================================
00001000                            94  ; SYSTEM MANAGEMENT (SYSTEM CODE)
00001000                            95  ; =============================================================================
00001000                            96  
00001000                            97  ; -----------------------------------------------------------------------------
00001000                            98  SYSINIT
00001000                            99  ; INITIALIZES THE SYSTEM
00001000                           100  ; INPUT    - NONE
00001000                           101  ; OUTPUT   - NONE
00001000                           102  ; MODIFIES - NONE
00001000                           103  ; -----------------------------------------------------------------------------
00001000  205F                     104              MOVE.L  (A7)+,A0                ; GET RETURN ADDRESS
00001002  4EB9 000010A2            105              JSR     KBDINIT                 ; INIT KEYBOARD
00001008  4EB9 0000101C            106              JSR     SCRINIT                 ; INIT SCREEN
0000100E  4EB9 00001192            107              JSR     DMMINIT                 ; INIT DYNAMIC MEMORY
00001014  027C DFFF                108              ANDI.W  #$DFFF,SR               ; SWITCH TO USER
00001018  2F08                     109              MOVE.L  A0,-(A7)                ; PUT RETURN ADDRESS
0000101A  4E75                     110              RTS
0000101C                           111  
0000101C                           112  ; =============================================================================
0000101C                           113  ; SCREEN MANAGEMENT (SYSTEM CODE)
0000101C                           114  ; =============================================================================
0000101C                           115  
0000101C                           116  ; -----------------------------------------------------------------------------
0000101C                           117  SCRINIT
0000101C                           118  ; INITIALIZES THE SCREEN, SCREEN-RELATED INTERRUPT AND VARS.
0000101C                           119  ; INPUT    - NONE
0000101C                           120  ; OUTPUT   - NONE
0000101C                           121  ; MODIFIES - D0,D1,D2,D3
0000101C                           122  ; -----------------------------------------------------------------------------
0000101C                           123              ; TO DO:
0000101C                           124              ; - DISABLE INTS (SET INT BITS IN SR TO 111)
0000101C  40C0                     125              MOVE.W  SR,D0
0000101E  807C 0700                126              OR.W    #$0700,D0
00001022  46C0                     127              MOVE.W  D0,SR
00001024                           128              ; - DISABLE ALL AUTO-IRQ (SEE TRAP #15 TASK 32)
00001024                           129              ; - INSTALL SCRUPD INTO TRAP SCRTRAP
00001024  21FC 0000108C 0084       130              MOVE.L  #SCRUPD,($80+SCRTRAP*4)
0000102C                           131              ; - SET RESOLUTION TO SCRWIDTH X SCRHEIGHT
0000102C  7021                     132              MOVEQ   #33,D0
0000102E  223C 028001E0            133              MOVE.L  #SCRWIDTH<<16+SCRHEIGH,D1
00001034  4E4F                     134              TRAP    #15
00001036                           135              ; - SET WINDOWED MODE
00001036  7201                     136              MOVE.L  #1,D1
00001038  4E4F                     137              TRAP    #15
0000103A                           138              ; - CLEAR VISIBLE BUFFER
0000103A  705E                     139              MOVEQ   #94,D0
0000103C  4E4F                     140              TRAP    #15
0000103E                           141              ; - ENABLE DOUBLE BUFFER
0000103E  705C                     142              MOVEQ   #92,D0
00001040  123C 0011                143              MOVE.B  #17,D1
00001044  4E4F                     144              TRAP    #15
00001046                           145              ; - CLEAR HIDDEN BUFFER
00001046  700B                     146              MOVEQ   #11,D0
00001048  3239 0000FF00            147              MOVE.W  $FF00,D1
0000104E  4E4F                     148              TRAP    #15
00001050                           149              ; - INSTALL SCRISR FOR IRQ SCRIRQ (IRQ INTERRUPT VECTOR BEGINS
00001050                           150              ;   AT $60. INSTALLATION IS SIMILAR TO TRAP INSTALLATION)
00001050  21FC 0000107E 0064       151              MOVE.L  #SCRISR,($60+SCRIRQ*4)
00001058                           152              ; - ENABLE AUTO-IRQ EVERY SCRTIM MS FOR IRQ SCRIRQ (SEE TRAP #15
00001058                           153              ;   TASK 32)
00001058  7020                     154              MOVEQ   #32,D0
0000105A  123C 0006                155              MOVE.B  #6,D1
0000105E  7401                     156              MOVE.L  #SCRIRQ,D2
00001060  843C 0080                157              OR.B    #$80,D2
00001064  7614                     158              MOVE.L  #SCRTIM,D3
00001066  4E4F                     159              TRAP    #15
00001068                           160              ; - CLEAR SCRINTCT AND SCRCYCCT
00001068  4239 00001ADC            161              CLR.B   (SCRINTCT)
0000106E  4239 00001ADD            162              CLR.B   (SCRCYCCT)
00001074                           163              ; - ENABLE INTS (SET INT BITS IN SR TO 000)
00001074  40C0                     164              MOVE.W  SR,D0
00001076  C07C F8FF                165              AND.W   #$F8FF,D0
0000107A  46C0                     166              MOVE.W  D0,SR
0000107C  4E75                     167              RTS
0000107E                           168  
0000107E                           169  ; -----------------------------------------------------------------------------
0000107E                           170  SCRISR
0000107E                           171  ; SCREEN TIMER ISR. INCREASES THE INTERRUPT COUNTER AND UPDATES DOUBLE BUFFER.
0000107E                           172  ; INPUT    - NONE
0000107E                           173  ; OUTPUT   - NONE
0000107E                           174  ; MODIFIES - NONE
0000107E                           175  ; -----------------------------------------------------------------------------
0000107E  5239 00001ADC            176              ADDQ.B  #1,(SCRINTCT)           ; UPDATE INT FLAG/COUNTER
00001084  5239 00001ADD            177              ADDQ.B  #1,(SCRCYCCT)           ; UPDATE CYCLE COUNTER
0000108A  4E73                     178              RTE
0000108C                           179  
0000108C                           180  ; -----------------------------------------------------------------------------
0000108C                           181  SCRUPD
0000108C                           182  ; TRAP SERVICE ROUTINE IN CHARGE OF VISUALIZING CURRENT FRAME AND CLEARING
0000108C                           183  ; BUFFER FOR THE NEXT ONE.
0000108C                           184  ; INPUT    - NONE
0000108C                           185  ; OUTPUT   - NONE
0000108C                           186  ; MODIFIES - NONE
0000108C                           187  ; -----------------------------------------------------------------------------
0000108C                           188              ; TO DO: UPDATE DOUBLE BUFFER AND CLEAR HIDDEN BUFFER
0000108C  48E7 C000                189              MOVEM.L D0-D1,-(A7)
00001090  705E                     190              MOVEQ   #94,D0
00001092  4E4F                     191              TRAP    #15
00001094  700B                     192              MOVEQ   #11,D0
00001096  323C FF00                193              MOVE.W  #$FF00,D1
0000109A  4E4F                     194              TRAP    #15
0000109C  4CDF 0003                195              MOVEM.L (A7)+,D0-D1
000010A0  4E73                     196              RTE
000010A2                           197  
000010A2                           198  ; =============================================================================
000010A2                           199  ; KEYBOARD MANAGEMENT (SYSTEM CODE)
000010A2                           200  ; =============================================================================
000010A2                           201  
000010A2                           202  ; -----------------------------------------------------------------------------
000010A2                           203  KBDINIT
000010A2                           204  ; INITIALIZES THE SYSTEM VARIABLES KBDSYS AND KBDVAL
000010A2                           205  ; INPUT    - NONE
000010A2                           206  ; OUTPUT   - NONE
000010A2                           207  ; MODIFIES - NONE
000010A2                           208  ; -----------------------------------------------------------------------------
000010A2  4239 00001ADA            209              CLR.B   (KBDVAL)                 ; INIT VARS
000010A8  4239 00001ADB            210              CLR.B   (KBDEDGE)
000010AE  21FC 000010B8 0080       211              MOVE.L  #KBDREAD,($80+KBDTRAP*4) ; INSTALL
000010B6  4E75                     212              RTS
000010B8                           213  
000010B8                           214  ; -----------------------------------------------------------------------------
000010B8                           215  KBDREAD
000010B8                           216  ; TRAP SERVICE ROUTINE.
000010B8                           217  ; UPDATES THE SYSTEM VARIABLES KBDEDGE AND KBDVAL ACCORDING TO THE BITFIELD
000010B8                           218  ; DESCRIBED IN SYSCONST. KBDVAL HOLDS THE CURRENT VALUES AND KBDEDGE HOLDS
000010B8                           219  ; RISING EDGES FROM PREVIOUS CALL TO THE CURRENT ONE.
000010B8                           220  ; INPUT    - NONE
000010B8                           221  ; OUTPUT   - (KBDVAL) AND (KBDEDGE)
000010B8                           222  ; MODIFIES - NONE
000010B8                           223  ; -----------------------------------------------------------------------------
000010B8                           224              ; TO DO: UPDATE KBDVAL AND KBDEDGE
000010B8  48E7 F000                225              MOVEM.L D0-D3,-(A7)
000010BC  1639 00001ADA            226              MOVE.B  (KBDVAL),D3
000010C2                           227              ;PUT IN D2 THE VALUES OF KEYS: ARROW LEFT, UP, RIGHT AND DOWN
000010C2  7013                     228              MOVEQ   #19,D0
000010C4  223C 25262728            229              MOVE.L  #KBDLEFT<<24+KBDUP<<16+KBDRIGHT<<8+KBDDOWN,D1
000010CA  4E4F                     230              TRAP    #15
000010CC  2401                     231              MOVE.L  D1,D2
000010CE                           232              ;PUT IN D1 THE VALUES OF KEYS: FIRE1, FIRE2, FIRE3 AND PAUSE
000010CE  223C 204D1050            233              MOVE.L  #KBDFIRE1<<24+KBDFIRE2<<16+KBDFIRE3<<8+KBDPAUSE,D1
000010D4  4E4F                     234              TRAP    #15
000010D6                           235              
000010D6                           236              ;SET D3 WITH KEYS PRESSED AND NOT PRESSED
000010D6  0802 0018                237              BTST.L  #24,D2
000010DA  6600 000A                238              BNE     .KBDLEFT
000010DE  0203 00FE                239              ANDI.B  #%11111110,D3
000010E2  6000 0006                240              BRA     .COND1
000010E6                           241  .KBDLEFT    ;LEFT ARROW PRESSED
000010E6  0003 0001                242              ORI.B   #KBDMSKLF,D3
000010EA                           243  
000010EA                           244  .COND1
000010EA  0802 0010                245              BTST.L  #16,D2
000010EE  6600 000A                246              BNE     .KBDUP
000010F2  0203 00FD                247              ANDI.B  #%11111101,D3
000010F6  6000 0006                248              BRA     .COND2
000010FA                           249  .KBDUP      ;UP ARROW PRESSED
000010FA  0003 0002                250              ORI.B   #KBDMSKUP,D3
000010FE                           251  .COND2
000010FE  0802 0008                252              BTST.L  #8,D2
00001102  6600 000A                253              BNE     .KBDRT
00001106  0203 00FB                254              ANDI.B  #%11111011,D3
0000110A  6000 0006                255              BRA     .COND3
0000110E                           256  .KBDRT      ;RIGHT ARROW PRESSED
0000110E  0003 0004                257              ORI.B   #KBDMSKRT,D3
00001112                           258  .COND3
00001112  0802 0000                259              BTST.L  #0,D2
00001116  6600 000A                260              BNE     .KBDDOWN
0000111A  0203 00F7                261              ANDI.B  #%11110111,D3
0000111E  6000 0006                262              BRA     .COND4
00001122                           263  .KBDDOWN    ;DOWN ARROW PRESSED
00001122  0003 0008                264              ORI.B   #KBDMSKDN,D3
00001126                           265  .COND4
00001126  0801 0018                266              BTST.L  #24,D1
0000112A  6600 000A                267              BNE     .KBDF1
0000112E  0203 00EF                268              ANDI.B  #%11101111,D3
00001132  6000 0006                269              BRA     .COND5
00001136                           270  .KBDF1     ;FIRE1 PRESSED
00001136  0003 0010                271              ORI.B   #KBDMSKF1,D3
0000113A                           272  
0000113A                           273  .COND5
0000113A  0801 0010                274              BTST.L  #16,D1
0000113E  6600 000A                275              BNE     .KBDF2
00001142  0203 00DF                276              ANDI.B  #%11011111,D3
00001146  6000 0006                277              BRA     .COND6
0000114A                           278  .KBDF2      ;FIRE2 PRESSED
0000114A  0003 0020                279              ORI.B  #KBDMSKF2,D3
0000114E                           280  .COND6
0000114E  0801 0008                281              BTST.L  #8,D1
00001152  6600 000A                282              BNE     .KBDF3
00001156  0203 00BF                283              ANDI.B  #%10111111,D3
0000115A  6000 0006                284              BRA     .COND7
0000115E                           285  .KBDF3      ;FIRE3 PRESSED
0000115E  0003 0040                286              ORI.B   #KBDMSKF3,D3
00001162                           287  .COND7
00001162  0801 0000                288              BTST.L  #0,D1
00001166  6600 000A                289              BNE     .KBDP
0000116A  0203 007F                290              ANDI.B  #%01111111,D3
0000116E  6000 0006                291              BRA     .FINISH
00001172                           292  .KBDP       ;PAUSE PRESSED
00001172  0003 0080                293              ORI.B   #KBDMSKPS,D3
00001176                           294  
00001176                           295  .FINISH     ;PUT D3 IN (KBDVAL) AND SET (KBDEDGE)
00001176  1239 00001ADA            296              MOVE.B  (KBDVAL),D1
0000117C  13C3 00001ADA            297              MOVE.B  D3,(KBDVAL)
00001182  4601                     298              NOT.B   D1
00001184  C601                     299              AND.B   D1,D3
00001186  13C3 00001ADB            300              MOVE.B  D3,(KBDEDGE)
0000118C  4CDF 000F                301              MOVEM.L (A7)+,D0-D3
00001190  4E73                     302              RTE
00001192                           303  
00001192                           304  
00001192                           305  ; =============================================================================
00001192                           306  ; DYNAMIC MEMORY MANAGEMENT (SYSTEM CODE)
00001192                           307  ; DYNAMIC MEMORY IS A SET OF DMMBNUM SLOTS OF DMMBSIZE BYTES EACH ONE.
00001192                           308  ; DMMBSIZE MUST BE POWER OF TWO. A SLOT HAS:
00001192                           309  ; - HEADER - 1 WORD. SPECIFIES THE OWNER (0 MEANS OWNED BY SYSTEM)
00001192                           310  ; - DATA   - DMMBSIZE - 2 BYTES. MAY CONTAIN VARS AND ANY KIND OF DATA RELATED
00001192                           311  ;            THE THE OWNER. IF OWNER==0, DATA IS MEANINGLESS.
00001192                           312  ; =============================================================================
00001192                           313  
00001192                           314  ; -----------------------------------------------------------------------------
00001192                           315  DMMINIT
00001192                           316  ; INITIALIZES THE DYNAMIC MEMORY TO ALL OWNED BY SYSTEM.
00001192                           317  ; INPUT    - NONE
00001192                           318  ; OUTPUT   - NONE
00001192                           319  ; MODIFIES - NONE
00001192                           320  ; -----------------------------------------------------------------------------
00001192  48E7 8080                321              MOVEM.L D0/A0,-(A7)
00001196  41F9 00001B40            322              LEA     DMMDATA,A0
0000119C  303C 0031                323              MOVE.W  #DMMBNUM-1,D0
000011A0  30BC 0000                324  .LOOP       MOVE.W  #DMMSYSID,(A0)
000011A4  D1FC 00000040            325              ADD.L   #DMMBSIZE,A0
000011AA  51C8 FFF4                326              DBRA.W  D0,.LOOP
000011AE  4CDF 0101                327              MOVEM.L (A7)+,D0/A0
000011B2  4E75                     328              RTS
000011B4                           329  
000011B4                           330  ; -----------------------------------------------------------------------------
000011B4                           331  DMMFIRST
000011B4                           332  ; SEARCHES THE FIRST MEMORY SLOT NOT OWNED BY SYSTEM AND OUTPUTS A POINTER
000011B4                           333  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
000011B4                           334  ; INPUT    - NONE
000011B4                           335  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
000011B4                           336  ; MODIFIES - NONE (ASIDE OF OUTPUT)
000011B4                           337  ; -----------------------------------------------------------------------------
000011B4  41F9 00001B40            338              LEA     DMMDATA,A0
000011BA  4A58                     339  DMMFRLOP    TST.W   (A0)+
000011BC  6600 0016                340              BNE     DMMFRFND
000011C0  D1FC 0000003E            341              ADD.L   #DMMBSIZE-2,A0
000011C6  B1FC 000027BF            342  DMMFRCOM    CMP.L   #DMMDATA+DMMBSIZE*DMMBNUM-1,A0
000011CC  6DEC                     343              BLT     DMMFRLOP
000011CE  207C 00000000            344              MOVE.L  #0,A0
000011D4  4E75                     345  DMMFRFND    RTS
000011D6                           346  
000011D6                           347  ; -----------------------------------------------------------------------------
000011D6                           348  DMMNEXT
000011D6                           349  ; SEARCHES THE NEXT MEMORY SLOT NOT OWNED BY SYSTEM AND OUTPUTS A POINTER
000011D6                           350  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
000011D6                           351  ; INPUT    - A0   : POINTER WITHIN THE CURRENT SLOT
000011D6                           352  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
000011D6                           353  ; MODIFIES - NONE (ASIDE OF OUTPUT)
000011D6                           354  ; -----------------------------------------------------------------------------
000011D6  2F00                     355              MOVE.L  D0,-(A7)
000011D8  2008                     356              MOVE.L  A0,D0
000011DA  C0BC FFFFFFC0            357              AND.L   #-DMMBSIZE,D0           ; TAKE ADVANTAGE OF ALIGNMENT
000011E0  0680 00000040            358              ADD.L   #DMMBSIZE,D0
000011E6  2040                     359              MOVE.L  D0,A0
000011E8  201F                     360              MOVE.L  (A7)+,D0
000011EA  60DA                     361              BRA     DMMFRCOM
000011EC                           362  
000011EC                           363  ; -----------------------------------------------------------------------------
000011EC                           364  DMMFRSTO
000011EC                           365  ; SEARCHES THE FIRST MEMORY SLOT WITH THE SPECIFIED ID AND OUTPUTS A POINTER
000011EC                           366  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
000011EC                           367  ; INPUT    - D0.W : ID TO SEARCH
000011EC                           368  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
000011EC                           369  ; MODIFIES - NONE (ASIDE OF OUTPUT)
000011EC                           370  ; -----------------------------------------------------------------------------
000011EC  41F9 00001B40            371              LEA     DMMDATA,A0
000011F2  B058                     372  DMMFLOOP    CMP.W   (A0)+,D0
000011F4  6700 0016                373              BEQ     DMMFFND
000011F8  D1FC 0000003E            374              ADD.L   #DMMBSIZE-2,A0
000011FE  B1FC 000027BF            375  DMMFCOM     CMP.L   #DMMDATA+DMMBSIZE*DMMBNUM-1,A0
00001204  6DEC                     376              BLT     DMMFLOOP
00001206  207C 00000000            377              MOVE.L  #0,A0
0000120C  4E75                     378  DMMFFND     RTS
0000120E                           379  
0000120E                           380  ; -----------------------------------------------------------------------------
0000120E                           381  DMMNEXTO
0000120E                           382  ; SEARCHES THE NEXT MEMORY SLOT WITH THE SPECIFIED ID AND OUTPUTS A POINTER
0000120E                           383  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
0000120E                           384  ; INPUT    - D0.W : ID TO SEARCH
0000120E                           385  ;            A0   : POINTER WITHIN THE CURRENT SLOT
0000120E                           386  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
0000120E                           387  ; MODIFIES - NONE (ASIDE OF OUTPUT)
0000120E                           388  ; -----------------------------------------------------------------------------
0000120E  2F00                     389              MOVE.L  D0,-(A7)
00001210  2008                     390              MOVE.L  A0,D0
00001212  C0BC FFFFFFC0            391              AND.L   #-DMMBSIZE,D0           ; TAKE ADVANTAGE OF ALIGNMENT
00001218  0680 00000040            392              ADD.L   #DMMBSIZE,D0
0000121E  2040                     393              MOVE.L  D0,A0
00001220  201F                     394              MOVE.L  (A7)+,D0
00001222  60DA                     395              BRA     DMMFCOM
00001224                           396  
00001224                           397  ; -----------------------------------------------------------------------------
00001224                           398  DMMALLOC
00001224                           399  ; SEARCHES THE FIRST FREE (SYS OWNED) SLOT, ASSIGNS TO THE SPECIFIED OWNER
00001224                           400  ; AND RETURNS A POINTER TO THE CORRESPONDING DATA (SLOT ADDRESS + 2)
00001224                           401  ; INPUT    - D0.W : ID TO ASSIGN
00001224                           402  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FREE SPACE
00001224                           403  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00001224                           404  ; -----------------------------------------------------------------------------
00001224  3F00                     405              MOVE.W  D0,-(A7)
00001226  4240                     406              CLR.W   D0
00001228  4EB8 11EC                407              JSR     DMMFRSTO
0000122C  301F                     408              MOVE.W  (A7)+,D0
0000122E  B1FC 00000000            409              CMP.L   #0,A0
00001234  6700 0006                410              BEQ     .END
00001238  3140 FFFE                411              MOVE.W  D0,-2(A0)
0000123C  4E75                     412  .END        RTS
0000123E                           413  
0000123E                           414  ; -----------------------------------------------------------------------------
0000123E                           415  DMMFREE
0000123E                           416  ; FREES THE SLOT TO WHICH THE PROVIDED POINTER BELONGS BY SETTING ITS OWNED TO
0000123E                           417  ; SYSTEM (0)
0000123E                           418  ; INPUT    - A0   : POINTER BELONGING TO THE SLOT TO FREE
0000123E                           419  ; OUTPUT   - NONE
0000123E                           420  ; MODIFIES - NONE
0000123E                           421  ; -----------------------------------------------------------------------------
0000123E  48E7 8080                422              MOVEM.L D0/A0,-(A7)
00001242  2008                     423              MOVE.L  A0,D0
00001244  C0BC FFFFFFC0            424              AND.L   #-DMMBSIZE,D0           ; TAKE ADVANTAGE OF ALIGNMENT
0000124A  2040                     425              MOVE.L  D0,A0
0000124C  4250                     426              CLR.W   (A0)
0000124E  4CDF 0101                427              MOVEM.L (A7)+,D0/A0
00001252  4E75                     428              RTS
00001254                           429  
00001254                           430  
00001254                           431  
00001254                           432  
00001254                           433  
00001254                           434  
00001254                           435  
00001254                           436  
00001254                           437  
00001254                           438  
00001254                           439  
00001254                           440  
00001254                           441  
00001254                           442  
00001254                           443  
00001254                           444  
00001254                           445  
00001254                           446  
00001254                           447  
00001254                           448  
00001254                           449  
00001254                           450  
00001254                           451  
00001254                           452  
00001254                           453  
00001254                           454  
00001254                           455  
00001254                           456  
00001254                           457  
00001254                           458  
00001254                           459  
00001254                           460  
00001254                           461  
00001254                           462  
00001254                           463  
00001254                           464  -------------------- end include --------------------
00001254                           465              INCLUDE "CONST.X68"             ; USER CONSTANTS
00001254                           466  ; =============================================================================
00001254                           467  ; SYSTEM CONSTANTS
00001254                           468  ; =============================================================================
00001254                           469  
00001254                           470  ; --- GAME STATES -------------------------------------------------------------
00001254                           471  
00001254  =FFFFFFFF                472  STANONE     EQU     -1                      ; PLACEHOLDER TO FORCE CHANGE
00001254  =00000000                473  STAINTR     EQU     0                       ; INTRO/PRESS SPACE BAR STATE
00001254  =00000001                474  STAPLAY     EQU     1                       ; NORMAL GAME STATE
00001254  =00000002                475  STAGOVR     EQU     2                       ; GAME OVER STATE
00001254                           476  
00001254                           477  ; --- AGENT TYPES -------------------------------------------------------------
00001254                           478  
00001254  =00000001                479  SHTTYPE     EQU     1
00001254  =00000002                480  ASTTYPE     EQU     2
00001254  =00000003                481  XPLTYPE     EQU     3
00001254  =00000004                482  COINTYPE    EQU     4
00001254                           483  
00001254                           484  ; --- PLAYER RELATED CONSTANTS ------------------------------------------------
00001254                           485  
00001254  =0000001E                486  PLRWIDTH    EQU     30                      ; PLAYER WIDTH (PIXELS)
00001254  =0000001E                487  PLRHEIGH    EQU     30                      ; PLAYER HEIGHT (PIXELS)
00001254  =00000005                488  PLRSPDX     EQU     5                       ; PLAYER SPEED UPON X AXIS
00001254  =00000001                489  PLRACCY     EQU     1                       ; PLAYER ACCELERATION UPON Y AXIS (USED FOR GRAVITATIONAL PURPOSES)
00001254  =000000FF                490  PLRCOLOR    EQU     $000000FF               ; PLAYER COLOR
00001254  =00FFFFFF                491  PLRTXTCL    EQU     $00FFFFFF               ; FONT COLOR
00001254  =00000002                492  PLRTXTX     EQU     2                       ; SCORE X COORDINATE
00001254  =00000001                493  PLRTXTY     EQU     1                       ; SCORE Y COORDINATE
00001254                           494  
00001254                           495  ; --- PIPE RELATED CONSTANTS ----------------------------------------------
00001254                           496  
00001254  =00000078                497  HOLHEIGH    EQU     120                     ; HOLE HEIGH
00001254  =0000003C                498  PIPWIDTH    EQU     60
00001254  =00FFFFFF                499  PIPPENCL    EQU     $00FFFFFF               ; PIPE PEN COLOR
00001254  =00008000                500  PIPFILCL    EQU     $00008000               ; PIPE FIL COLOR
00001254  =00000005                501  PIPEDGE     EQU     5                       ; PIPE EDGE WIDTH
00001254  =00000005                502  PIPXSPD     EQU     5                       ; PIPE X SPEED 
00001254  =00000003                503  PIPYSPD     EQU     3                       ; PIPE Y SPEED 
00001254  =00000005                504  PIPSCORE    EQU     5                       ; SCORE FOR PIPE
00001254                           505  
00001254                           506  ; --- COIN RELATED CONSTANTS ---------------------------------------------
00001254                           507  
00001254  =00000019                508  COINSIZE    EQU     25                      ; COIN DIAMETER (PIXELS)
00001254  =00000000                509  CNPENCL     EQU     $00000000               ; COIN PEN COLOR
00001254  =0000FFFF                510  CNFILCL     EQU     $0000FFFF               ; COIN FIL COLOR
00001254  =00000005                511  COINXSPD    EQU     5                       ; COIN SPEED UPON X AXIS
00001254                           512  
00001254                           513  ; --- INTRO STATE RELATED CONSTANTS -------------------------------------------
00001254                           514  
00001254  =00000019                515  INTTITX     EQU     25                      ; TITLE X COORDINATE
00001254  =00000005                516  INTTITY     EQU     5                       ; TITLE Y COORDINATE
00001254  =000000FF                517  INTTITC     EQU     $000000FF               ; TITLE COLOR
00001254  =0000001F                518  INTPRSX     EQU     31                      ; SPACE BAR X COORDINATE
00001254  =00000017                519  INTPRSY     EQU     23                      ; SPACE BAR Y COORDINATE
00001254  =00FFFFFF                520  INTPRSC     EQU     $00FFFFFF               ; PRESS SPACE BAR COLOR
00001254                           521  
00001254                           522  ; --- GAME OVER STATE RELATED CONSTANTS ---------------------------------------
00001254                           523  
00001254  =00000023                524  GOVSTRX     EQU     35                      ; TITLE X COORDINATE
00001254  =0000000F                525  GOVSTRY     EQU     15                      ; TITLE Y COORDINATE
00001254  =00FFFFFF                526  GOVSTRC     EQU     $00FFFFFF               ; TITLE COLOR
00001254                           527  
00001254                           528  
00001254                           529  
00001254                           530  -------------------- end include --------------------
00001254                           531              INCLUDE "UTIL.X68"              ; UTILITY MACRO AND SUBROUTINES
00001254                           532  ; =============================================================================
00001254                           533  ; UTILITY MACROS
00001254                           534  ; =============================================================================
00001254                           535  
00001254                           536  ; -----------------------------------------------------------------------------
00001254                           537  UTLSPEN     MACRO
00001254                           538  ; WRAPPER FOR SET PEN TRAP 15 TASK.
00001254                           539  ; INPUT    - \1 COLOR IN FORMAT $00BBGGRR
00001254                           540  ; OUTPUT   - NONE
00001254                           541  ; MODIFIES - D0,D1
00001254                           542  ; -----------------------------------------------------------------------------
00001254                           543              MOVE.B  #80,D0
00001254                           544              MOVE.L  \1,D1
00001254                           545              TRAP    #15
00001254                           546              ENDM
00001254                           547  
00001254                           548  ; -----------------------------------------------------------------------------
00001254                           549  UTLSFIL     MACRO
00001254                           550  ; WRAPPER FOR SET FIL TRAP 15 TASK.
00001254                           551  ; INPUT    - \1 COLOR IN FORMAT $00BBGGRR
00001254                           552  ; OUTPUT   - NONE
00001254                           553  ; MODIFIES - D0,D1
00001254                           554  ; -----------------------------------------------------------------------------
00001254                           555              MOVE.B  #81,D0
00001254                           556              MOVE.L  \1,D1
00001254                           557              TRAP    #15
00001254                           558              ENDM
00001254                           559  
00001254                           560  ; -----------------------------------------------------------------------------
00001254                           561  UTLLOCT     MACRO
00001254                           562  ; WRAPPER TO TEXT POSITIONNING FROM TRAP 15
00001254                           563  ; INPUT    - \1 X, \2 Y
00001254                           564  ; OUTPUT   - NONE
00001254                           565  ; MODIFIES - D0,D1
00001254                           566  ; -----------------------------------------------------------------------------
00001254                           567              MOVE.W  #\1<<8|\2, D1
00001254                           568              MOVE.B  #11,D0
00001254                           569              TRAP    #15
00001254                           570              ENDM
00001254                           571  
00001254                           572  ; -----------------------------------------------------------------------------
00001254                           573  UTLSND     MACRO
00001254                           574  ; WRAPPER FOR PLAYING WAV FILE TRAP 15 TASK
00001254                           575  ; INPUT    - \1 ADDRESS TO STRING WITH NAME OF THE FILE
00001254                           576  ; OUTPUT   - D0.W=0 IF SOUND NOT PLAYED, NON ZERO IF PLAYED
00001254                           577  ; MODIFIES - D0,A1
00001254                           578  ; -----------------------------------------------------------------------------
00001254                           579              LEA     \1, A1             ;PLAY EXPLOSION SOUND
00001254                           580              ;MOVE.L  #0,D1
00001254                           581              ;MOVE.L  #0,D2
00001254                           582              MOVE.L  #73,D0
00001254                           583              TRAP    #15
00001254                           584              ENDM
00001254                           585  
00001254                           586  ; =============================================================================
00001254                           587  ; UTILITY SUBROUTINES
00001254                           588  ; =============================================================================
00001254                           589  
00001254                           590  ; -----------------------------------------------------------------------------
00001254                           591  UTLINIT
00001254                           592  ; INITIALIZES UTILITY CODE
00001254                           593  ; INPUT    - NONE
00001254                           594  ; OUTPUT   - NONE
00001254                           595  ; MODIFIES - NONE
00001254                           596  ; -----------------------------------------------------------------------------
00001254  4239 000027D6            597              CLR.B   (UTLRNDIX)
0000125A  4E75                     598              RTS
0000125C                           599  ; -----------------------------------------------------------------------------
0000125C                           600  UTLCHCOL
0000125C                           601  ; CHECKS COLLISION BETWEEN PLAYER AND PIPE
0000125C                           602  ; INPUT    - D0.W X0 COORDINATE
0000125C                           603  ;            D1.W Y0 COORDINATE
0000125C                           604  ;            D2.W X1 COORDINATE
0000125C                           605  ;            D3.W Y1 COORDINATE
0000125C                           606  ;            D4.W WIDTH 0
0000125C                           607  ;            D5.W WIDTH 1
0000125C                           608  ;            D6.W HEIGHT 0
0000125C                           609  ;            D7.W HEIGHT 1
0000125C                           610  ; OUTPUT   - D0.B=FF - COLLISION, =0 - NO COLLISION
0000125C                           611  ; MODIFIES - NONE
0000125C                           612  ; -----------------------------------------------------------------------------
0000125C  48A7 0F00                613              MOVEM.W D4-D7,-(A7)
00001260  D840                     614              ADD.W   D0,D4
00001262  B842                     615              CMP.W   D2,D4
00001264  6F00 0022                616              BLE     .NOCOL
00001268  DA42                     617              ADD.W   D2,D5
0000126A  BA40                     618              CMP.W   D0,D5
0000126C  6F00 001A                619              BLE     .NOCOL
00001270  DC41                     620              ADD.W   D1,D6
00001272  BC43                     621              CMP.W   D3,D6
00001274  6F00 0012                622              BLE     .NOCOL
00001278  DE43                     623              ADD.W   D3,D7
0000127A  BE41                     624              CMP.W   D1,D7
0000127C  6F00 000A                625              BLE     .NOCOL
00001280  103C 00FF                626              MOVE.B  #$FF,D0
00001284  6000 0004                627              BRA     .END
00001288  4200                     628  .NOCOL      CLR.B   D0
0000128A  4C9F 00F0                629  .END        MOVEM.W (A7)+,D4-D7
0000128E  4E75                     630              RTS
00001290                           631  ; -----------------------------------------------------------------------------
00001290                           632  UTLRAND
00001290                           633  ; PROVIDES A PSEUDO-RANDOM BYTE
00001290                           634  ; INPUT    - NONE
00001290                           635  ; OUTPUT   - D0.L RANDOM VALUE (ONLY BYTE)
00001290                           636  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00001290                           637  ; -----------------------------------------------------------------------------
00001290  2F08                     638              MOVE.L  A0,-(A7)
00001292  41F9 000012AE            639              LEA     .RANDVEC,A0
00001298  4280                     640              CLR.L   D0
0000129A  1039 000027D6            641              MOVE.B  (UTLRNDIX),D0
000012A0  1030 0800                642              MOVE.B  (A0,D0.L),D0
000012A4  5239 000027D6            643              ADDQ.B  #1,(UTLRNDIX)
000012AA  205F                     644              MOVE.L  (A7)+,A0
000012AC  4E75                     645              RTS
000012AE                           646  
000012AE                           647  
000012AE= A2 EE 9A 0C F5 24 ...    648  .RANDVEC    DC.B    162, 238, 154, 12 , 245, 36 , 32 , 103
000012B6= 2A A3 51 26 E0 AC ...    649              DC.B    42 , 163, 81 , 38 , 224, 172, 19 , 69
000012BE= 75 51 CA FD 33 EB ...    650              DC.B    117, 81 , 202, 253, 51 , 235, 108, 154
000012C6= 60 CC E7 B8 9A EB ...    651              DC.B    96 , 204, 231, 184, 154, 235, 34 , 203
000012CE= 1D 76 B5 95 B0 89 ...    652              DC.B    29 , 118, 181, 149, 176, 137, 62 , 108
000012D6= 39 15 48 C9 6E CA ...    653              DC.B    57 , 21 , 72 , 201, 110, 202, 159, 41
000012DE= 43 E7 E2 7C 37 25 ...    654              DC.B    67 , 231, 226, 124, 55 , 37 , 84 , 62
000012E6= E9 94 CE E9 E4 52 ...    655              DC.B    233, 148, 206, 233, 228, 82 , 243, 78
000012EE= 37 6D 9A 84 A2 28 ...    656              DC.B    55 , 109, 154, 132, 162, 40 , 30 , 39
000012F6= 19 E2 C6 77 80 D4 ...    657              DC.B    25 , 226, 198, 119, 128, 212, 232, 225
000012FE= 0A 5A 32 67 33 C2 ...    658              DC.B    10 , 90 , 50 , 103, 51 , 194, 222, 40
00001306= 59 80 DC 0E 57 FC ...    659              DC.B    89 , 128, 220, 14 , 87 , 252, 243, 252
0000130E= 8A AB BC F7 07 4D ...    660              DC.B    138, 171, 188, 247, 7  , 77 , 29 , 234
00001316= EF D5 77 6E 1E BB ...    661              DC.B    239, 213, 119, 110, 30 , 187, 131, 23
0000131E= D6 E0 2A 8F BD 28 ...    662              DC.B    214, 224, 42 , 143, 189, 40 , 212, 130
00001326= 13 4F 66 EC 0A 64 ...    663              DC.B    19 , 79 , 102, 236, 10 , 100, 122, 188
0000132E= 56 52 9A 16 9B 90 ...    664              DC.B    86 , 82 , 154, 22 , 155, 144, 7  , 199
00001336= 06 8A A4 F7 01 DA ...    665              DC.B    6  , 138, 164, 247, 1  , 218, 166, 82
0000133E= F2 E7 77 28 B1 76 ...    666              DC.B    242, 231, 119, 40 , 177, 118, 220, 102
00001346= A4 42 E3 81 B1 67 ...    667              DC.B    164, 66 , 227, 129, 177, 103, 165, 108
0000134E= BF CE FA 16 BF 38 ...    668              DC.B    191, 206, 250, 22 , 191, 56 , 30 , 161
00001356= D1 8B 50 0C 5F 49 ...    669              DC.B    209, 139, 80 , 12 , 95 , 73 , 168, 56
0000135E= DE 4C 14 A2 40 DC ...    670              DC.B    222, 76 , 20 , 162, 64 , 220, 93 , 12
00001366= B6 9B 0A 38 5D AB ...    671              DC.B    182, 155, 10 , 56 , 93 , 171, 89 , 6
0000136E= E2 1B DD 75 15 82 ...    672              DC.B    226, 27 , 221, 117, 21 , 130, 101, 18
00001376= 8A 26 51 30 9F 47 ...    673              DC.B    138, 38 , 81 , 48 , 159, 71 , 57 , 21
0000137E= 1E 8A BB 71 C6 6E ...    674              DC.B    30 , 138, 187, 113, 198, 110, 185, 152
00001386= 9F 47 E5 34 94 27 ...    675              DC.B    159, 71 , 229, 52 , 148, 39 , 77 , 6
0000138E= 7D 06 D6 BA 30 0F ...    676              DC.B    125, 6  , 214, 186, 48 , 15 , 212, 22
00001396= EC 7F 7E 03 CF 2D ...    677              DC.B    236, 127, 126, 3  , 207, 45 , 193, 2
0000139E= 94 5B 23 F2 8B CD ...    678              DC.B    148, 91 , 35 , 242, 139, 205, 248, 237
000013A6= 74 33 EC B9 0F D5 ...    679              DC.B    116, 51 , 236, 185, 15 , 213, 221, 6
000013AE                           680  
000013AE                           681  
000013AE                           682  
000013AE                           683  
000013AE                           684  
000013AE                           685  
000013AE                           686  
000013AE                           687  
000013AE                           688  
000013AE                           689  
000013AE                           690  -------------------- end include --------------------
000013AE                           691              INCLUDE "PLAYER.X68"            ; PLAYER MANAGEMENT
000013AE                           692  ; =============================================================================
000013AE                           693  ; PLAYER MANAGEMENT
000013AE                           694  ; =============================================================================
000013AE                           695  
000013AE                           696  ; -----------------------------------------------------------------------------
000013AE                           697  PLRINIT
000013AE                           698  ; INITIALIZES THE PLAYER
000013AE                           699  ; INPUT    - NONE
000013AE                           700  ; OUTPUT   - NONE
000013AE                           701  ; MODIFIES - NONE
000013AE                           702  ; -----------------------------------------------------------------------------
000013AE  33FC 0140 000027C4       703              MOVE.W  #SCRWIDTH/2,(PLRPOSX)
000013B6  33FC 0118 000027C6       704              MOVE.W  #SCRHEIGH-200,(PLRPOSY)
000013BE  4279 000027C8            705              CLR.W   (PLRSPDY)
000013C4  4279 000027D8            706              CLR.W   (PIPCOUNT)
000013CA  4279 000027CA            707              CLR.W   (PLRSCORE)
000013D0  4279 000027CC            708              CLR.W   (PLRDEAD)
000013D6                           709  
000013D6                           710  ; -----------------------------------------------------------------------------
000013D6                           711  PLRUPD
000013D6                           712  ; UPDATES THE PLAYER MOTION
000013D6                           713  ; INPUT    - NONE (ACCESSES KBDVAL AND KBDEDGE)
000013D6                           714  ; OUTPUT   - NONE (MODIFIES PLAYER DATA)
000013D6                           715  ; MODIFIES - NONE
000013D6                           716  ; -----------------------------------------------------------------------------
000013D6  2F00                     717              MOVE.L  D0,-(A7)
000013D8  3039 000027C8            718              MOVE.W  (PLRSPDY),D0
000013DE  D079 000027C6            719              ADD.W   (PLRPOSY),D0
000013E4  B07C 01C2                720              CMP.W   #SCRHEIGH-PLRHEIGH,D0
000013E8  6500 0006                721              BLO     .BOUNDUP
000013EC  6000 002C                722              BRA     .DEATH                  ; GAME OVER IF BENEATH THE BOTTOM LIMIT
000013F0  B07C 0000                723  .BOUNDUP    CMP.W   #0,D0
000013F4  6E00 0006                724              BGT     .BOUNDWN
000013F8  6000 0020                725              BRA     .DEATH                  ; GAME OVER IF OVER THE TOP LIMIT
000013FC  33C0 000027C6            726  .BOUNDWN    MOVE.W  D0,(PLRPOSY)
00001402  5279 000027C8            727              ADD.W   #PLRACCY,(PLRSPDY)
00001408  0C39 0000 000027CC       728              CMP.B   #0,(PLRDEAD)
00001410  6700 001A                729              BEQ     .NOTOUCH
00001414  4239 000027CC            730              CLR.B   (PLRDEAD)
0000141A  33FC 0002 000027C2       731  .DEATH      MOVE.W  #STAGOVR,(STANEXT)       ; GAME OVER STATE
00001422                           732m             UTLSND  .EXPSOUN                 ;PLAY EXPLOSION SOUND
00001422                           733m ; WRAPPER FOR PLAYING WAV FILE TRAP 15 TASK
00001422                           734m ; INPUT    - .EXPSOUN ADDRESS TO STRING WITH NAME OF THE FILE
00001422                           735m ; OUTPUT   - D0.W=0 IF SOUND NOT PLAYED, NON ZERO IF PLAYED
00001422                           736m ; MODIFIES - D0,A1
00001422                           737m ; -----------------------------------------------------------------------------
00001428                           738m             ;MOVE.L  #0,D1
00001428                           739m             ;MOVE.L  #0,D2
0000142C  201F                     740  .NOTOUCH    MOVE.L  (A7)+,D0
0000142E  3F01                     741              MOVE.W  D1,-(A7)
00001430  1239 00001ADA            742              MOVE.B  (KBDVAL),D1             ; PERFORM MOTION
00001436  E219                     743              ROR.B   #1,D1                   ; CHECK LEFT ARROW
00001438  6400 0018                744              BCC     .CHKUP
0000143C  5B79 000027C4            745              SUB.W   #PLRSPDX,(PLRPOSX)
00001442  4A79 000027C4            746              TST.W   (PLRPOSX)
00001448  6C00 0008                747              BGE     .CHKUP
0000144C  4279 000027C4            748              CLR.W   (PLRPOSX)
00001452  E219                     749  .CHKUP      ROR.B   #1,D1                   ; CHECK UP ARROW
00001454  6400 0016                750              BCC     .CHKRT
00001458  0839 0001 00001ADB       751              BTST.B  #KBDBITUP,(KBDEDGE)
00001460  6700 000A                752              BEQ     .CHKRT
00001464  33FC FFF6 000027C8       753              MOVE.W   #-10,(PLRSPDY)
0000146C  E219                     754  .CHKRT      ROR.B   #1,D1                   ; CHECK RIGHT ARROW
0000146E  6400 001C                755              BCC     .MDONE
00001472  5A79 000027C4            756              ADD.W   #PLRSPDX,(PLRPOSX)
00001478  0C79 0262 000027C4       757              CMP.W   #SCRWIDTH-PLRWIDTH,(PLRPOSX)
00001480  6F00 000A                758              BLE     .MDONE
00001484  33FC 0262 000027C4       759              MOVE.W  #SCRWIDTH-PLRWIDTH,(PLRPOSX)
0000148C  321F                     760  .MDONE     MOVE.W  (A7)+,D1
0000148E  4E75                     761              RTS
00001490= 4578706C 6F73696F ...    762  .EXPSOUN    DC.L    'Explosion.wav',0            ; EXPLOSION SOUND
000014A4                           763  
000014A4                           764  ; -----------------------------------------------------------------------------
000014A4                           765  PLRPLOT
000014A4                           766  ; PLOTS THE PLAYER ITS LIFE AND THE SCORE
000014A4                           767  ; INPUT    - NONE
000014A4                           768  ; OUTPUT   - NONE
000014A4                           769  ; MODIFIES - NONE
000014A4                           770  ; -----------------------------------------------------------------------------
000014A4  48E7 F800                771              MOVEM.L D0-D4,-(A7)
000014A8  223C 000000FF            772              MOVE.L  #PLRCOLOR,D1            ;SET COLOR OF PLAYER
000014AE  103C 0050                773              MOVE.B  #80,D0
000014B2  4E4F                     774              TRAP    #15
000014B4  5200                     775              ADDQ.B  #1,D0
000014B6  4E4F                     776              TRAP    #15
000014B8  3239 000027C4            777              MOVE.W  (PLRPOSX),D1            ; PLOT THE PLAYER
000014BE  3439 000027C6            778              MOVE.W  (PLRPOSY),D2
000014C4  3601                     779              MOVE.W  D1,D3
000014C6  3802                     780              MOVE.W  D2,D4
000014C8  0643 001E                781              ADD.W   #PLRWIDTH,D3
000014CC  0644 001E                782              ADD.W   #PLRHEIGH,D4
000014D0  103C 0058                783              MOVE.B  #88,D0
000014D4  4E4F                     784              TRAP    #15
000014D6  0443 000F                785              SUB.W   #PLRWIDTH/2,D3
000014DA  103C 0057                786              MOVE.B  #87,D0
000014DE  4E4F                     787              TRAP    #15
000014E0                           788              
000014E0                           789              ;PLOT EYE OF CHARACTER
000014E0  7200                     790              MOVE.L  #$00000000,D1            ; SET COLOR
000014E2  103C 0050                791              MOVE.B  #80,D0
000014E6  4E4F                     792              TRAP    #15
000014E8  5200                     793              ADDQ.B  #1,D0
000014EA  4E4F                     794              TRAP    #15
000014EC                           795  
000014EC  3239 000027C4            796              MOVE.W  (PLRPOSX),D1            ; SET BOUNDS
000014F2  0641 0014                797              ADD.W   #PLRWIDTH-10,D1
000014F6  3639 000027C4            798              MOVE.W  (PLRPOSX),D3
000014FC  0643 0018                799              ADD.W   #PLRWIDTH-6,D3
00001500  3439 000027C6            800              MOVE.W  (PLRPOSY),D2
00001506  5A42                     801              ADD.W   #PLRHEIGH/2-10,D2
00001508  3839 000027C6            802              MOVE.W  (PLRPOSY),D4
0000150E  0644 0009                803              ADD.W   #PLRHEIGH/2-6,D4
00001512  103C 0058                804              MOVE.B  #88,D0
00001516  4E4F                     805              TRAP    #15
00001518                           806              
00001518                           807              ; PLOT THE SCORE TEXT
00001518                           808m             UTLSPEN #PLRTXTCL
00001518                           809m ; WRAPPER FOR SET PEN TRAP 15 TASK.
00001518                           810m ; INPUT    - #PLRTXTCL COLOR IN FORMAT $00BBGGRR
00001518                           811m ; OUTPUT   - NONE
00001518                           812m ; MODIFIES - D0,D1
00001518                           813m ; -----------------------------------------------------------------------------
00001524                           814m             UTLSFIL #$00000000
00001524                           815m ; WRAPPER FOR SET FIL TRAP 15 TASK.
00001524                           816m ; INPUT    - #$00000000 COLOR IN FORMAT $00BBGGRR
00001524                           817m ; OUTPUT   - NONE
00001524                           818m ; MODIFIES - D0,D1
00001524                           819m ; -----------------------------------------------------------------------------
0000152C                           820m             UTLLOCT PLRTXTX,PLRTXTY
0000152C                           821m ; WRAPPER TO TEXT POSITIONNING FROM TRAP 15
0000152C                           822m ; INPUT    - PLRTXTX X, PLRTXTY Y
0000152C                           823m ; OUTPUT   - NONE
0000152C                           824m ; MODIFIES - D0,D1
0000152C                           825m ; -----------------------------------------------------------------------------
00001536  43F9 00001550            826              LEA     .SCORESTR,A1
0000153C  4281                     827              CLR.L   D1
0000153E  3239 000027CA            828              MOVE.W  (PLRSCORE),D1
00001544  103C 0011                829              MOVE.B  #17,D0
00001548  4E4F                     830              TRAP    #15
0000154A  4CDF 001F                831              MOVEM.L (A7)+,D0-D4
0000154E  4E75                     832              RTS
00001550= 53 43 4F 52 45 3A ...    833  .SCORESTR   DC.B    'SCORE: ',0
00001558                           834  
00001558                           835  
00001558                           836  
00001558                           837  
00001558                           838  
00001558                           839  
00001558                           840  
00001558                           841  
00001558                           842  
00001558                           843  
00001558                           844  
00001558                           845  
00001558                           846  
00001558                           847  
00001558                           848  
00001558                           849  
00001558                           850  
00001558                           851  
00001558                           852  
00001558                           853  
00001558                           854  
00001558                           855  
00001558                           856  
00001558                           857  
00001558                           858  
00001558                           859  
00001558                           860  
00001558                           861  
00001558                           862  
00001558                           863  
00001558                           864  
00001558                           865  
00001558                           866  
00001558                           867  
00001558                           868  
00001558                           869  
00001558                           870  
00001558                           871  
00001558                           872  
00001558                           873  
00001558                           874  
00001558                           875  -------------------- end include --------------------
00001558                           876              INCLUDE "AGENTLST.X68"          ; AGENT LIST MANAGEMENT
00001558                           877  ; =============================================================================
00001558                           878  ; AGENT MANAGEMENT
00001558                           879  ; EACH AGENT HAS A DATA BLOCK FROM DMM AS FOLLOWS:
00001558                           880  ; +0 - LONG : UPDATE SUBROUTINE POINTER
00001558                           881  ; +4 - LONG : PLOT SUBROUTINE POINTER
00001558                           882  ; +8:END    : DATA (AGENT SPECIFIC)
00001558                           883  ; =============================================================================
00001558                           884  
00001558                           885  ; -----------------------------------------------------------------------------
00001558                           886  AGLADD
00001558                           887  ; CREATES A NEW AGENT
00001558                           888  ; INPUT    - A1 - POINTER TO AGENT INIT FUNCTION
00001558                           889  ;            A2 - POINTER TO AGENT UPDATE FUNCTION
00001558                           890  ;            A3 - POINTER TO AGENT PLOT FUNCTION
00001558                           891  ;            D0 - AGENT TYPE (USED AS OWNED BY DMM)
00001558                           892  ;            D1 - AGENT INITIALIZATION PARAMETER 1
00001558                           893  ;            D2 - AGENT INITIALIZATION PARAMETER 2
00001558                           894  ;            D3 - AGENT INITIALIZATION PARAMETER 3
00001558                           895  ; OUTPUT   - NONE
00001558                           896  ; MODIFIES - NONE
00001558                           897  ; -----------------------------------------------------------------------------
00001558  2F08                     898              MOVE.L  A0,-(A7)
0000155A  4EB8 1224                899              JSR     DMMALLOC
0000155E  B1FC 00000000            900              CMP.L   #0,A0
00001564  6700 0008                901              BEQ     .END
00001568  20CA                     902              MOVE.L  A2,(A0)+
0000156A  20CB                     903              MOVE.L  A3,(A0)+
0000156C  4E91                     904              JSR     (A1)
0000156E  205F                     905  .END        MOVE.L  (A7)+,A0
00001570  4E75                     906              RTS
00001572                           907  
00001572                           908  ; -----------------------------------------------------------------------------
00001572                           909  AGLUPD
00001572                           910  ; UPDATES THE AGENT LIST. PRIOR TO CALLING THE UPDATE FUNCTIONS, A0 IS SET
00001572                           911  ; TO THE DATA BLOCK OF THE CORRESPONDING SLOT.
00001572                           912  ; INPUT    - NONE
00001572                           913  ; OUTPUT   - NONE
00001572                           914  ; MODIFIES - NONE
00001572                           915  ; -----------------------------------------------------------------------------
00001572  48E7 00C0                916              MOVEM.L A0-A1,-(A7)
00001576  4EB8 11B4                917              JSR     DMMFIRST
0000157A  B1FC 00000000            918  .LOOP       CMP.L   #0,A0
00001580  6700 000E                919              BEQ     .END
00001584  2250                     920              MOVE.L  (A0),A1
00001586  5088                     921              ADD.L   #8,A0
00001588  4E91                     922              JSR     (A1)
0000158A  4EB8 11D6                923              JSR     DMMNEXT
0000158E  60EA                     924              BRA     .LOOP
00001590  4CDF 0300                925  .END        MOVEM.L (A7)+,A0-A1
00001594  4E75                     926              RTS
00001596                           927  
00001596                           928  ; -----------------------------------------------------------------------------
00001596                           929  AGLPLOT
00001596                           930  ; PLOTS THE AGENT LIST. PRIOR TO CALLING THE UPDATE FUNCTIONS, A0 IS SET
00001596                           931  ; TO THE DATA BLOCK OF THE CORRESPONDING SLOT.
00001596                           932  ; INPUT    - NONE
00001596                           933  ; OUTPUT   - NONE
00001596                           934  ; MODIFIES - NONE
00001596                           935  ; -----------------------------------------------------------------------------
00001596  48E7 00C0                936              MOVEM.L A0-A1,-(A7)
0000159A  4EB8 11B4                937              JSR     DMMFIRST
0000159E  B1FC 00000000            938  .LOOP       CMP.L   #0,A0
000015A4  6700 0010                939              BEQ     .END
000015A8  2268 0004                940              MOVE.L  4(A0),A1
000015AC  5088                     941              ADD.L   #8,A0
000015AE  4E91                     942              JSR     (A1)
000015B0  4EB8 11D6                943              JSR     DMMNEXT
000015B4  60E8                     944              BRA     .LOOP
000015B6  4CDF 0300                945  .END        MOVEM.L (A7)+,A0-A1
000015BA  4E75                     946              RTS
000015BC                           947  
000015BC                           948  ; -----------------------------------------------------------------------------
000015BC  =0000123E                949  AGLKILL     EQU     DMMFREE
000015BC                           950  ; KILLS THE AGENT BY RELEASING ITS MEMORY
000015BC                           951  ; INPUT    - A0 POINTER WITHIN THE AGENT MEMORY
000015BC                           952  ; OUTPUT   - NONE
000015BC                           953  ; MODIFIES - NONE
000015BC                           954  ; NOTE     - IT IS JUST A WRAPPER FOR DMMFREE
000015BC                           955  ; -----------------------------------------------------------------------------
000015BC                           956  
000015BC                           957  
000015BC                           958  -------------------- end include --------------------
000015BC                           959              INCLUDE "PIPE.X68"              ; ASTEROID AGENT MANAGEMENT
000015BC                           960  ; =============================================================================
000015BC                           961  ; ASTEROID MANAGEMENT. IT IS AN AGENT.
000015BC                           962  ; LOCAL MEMORY IS:
000015BC                           963  ; +0 WORD X COORDINATE
000015BC                           964  ; +2 WORD Y COORDINATE
000015BC                           965  ; +4 WORD X SPEED
000015BC                           966  ; +6 WORD Y SPEED
000015BC                           967  ; +8 WORD PIPE SCORE
000015BC                           968  ; =============================================================================
000015BC                           969  
000015BC                           970  ; -----------------------------------------------------------------------------
000015BC                           971  PIPINIT
000015BC                           972  ; INITALIZES A PIPE
000015BC                           973  ; INPUT    - A0 POINTER TO THE LOCAL MEMORY
000015BC                           974  ; OUTPUT   - NONE
000015BC                           975  ; MODIFIES - NONE
000015BC                           976  ; NOTE     - ASSUMES SCRHEIGH IS GREATER THAN 255
000015BC                           977  ; -----------------------------------------------------------------------------
000015BC  3F00                     978              MOVE.W  D0,-(A7)
000015BE  4268 0008                979              CLR.W   8(A0)                   ; PIPE SCORED
000015C2  5279 000027D8            980              ADDQ.W  #1,(PIPCOUNT)           ; NUMBER OF PIPES +1
000015C8  30BC 0280                981              MOVE.W  #SCRWIDTH,(A0)          ; X POSITION
000015CC  4EB8 1290                982              JSR     UTLRAND
000015D0  3140 0002                983              MOVE.W  D0,2(A0)                ; Y POSITION (PSEUDO-RANDOM)            
000015D4  317C 0005 0004           984              MOVE.W  #PIPXSPD,4(A0)          ; X SPEED (PSEUDO-RANDOM)
000015DA  3039 000027D8            985              MOVE.W  (PIPCOUNT),D0
000015E0  48C0                     986              EXT.L   D0
000015E2  C0BC 0000FFFF            987              AND.L   #$0000FFFF,D0
000015E8  0C79 00FA 000027CA       988              CMP.W   #250,(PLRSCORE)
000015F0  6C00 0034                989              BGE     .YMOVE                  ; IF PIPES>=20: ALL MOVING PIPES
000015F4  0C79 0064 000027CA       990              CMP.W   #100,(PLRSCORE)
000015FC  6500 000E                991              BLO     .EASY
00001600  0800 0000                992              BTST    #0,D0                   ; WHILE 300>SCORE>=150: 1/2 MOVING PIPE
00001604  6700 0020                993              BEQ     .YMOVE
00001608  6000 0012                994              BRA     .YNOTMOV                  
0000160C  0800 0001                995  .EASY       BTST    #1,D0                   ; WHILE SCORE<15: 1/4 MOVING PIPE
00001610  6600 000A                996              BNE     .YNOTMOV
00001614  0800 0000                997              BTST    #0,D0
00001618  6700 000C                998              BEQ     .YMOVE
0000161C  317C 0000 0006           999  .YNOTMOV    MOVE.W  #0,6(A0)                ; Y SPEED (0)
00001622  6000 001E               1000              BRA     .END
00001626  4EB8 1290               1001  .YMOVE      JSR     UTLRAND                 ; Y SPEED (PIPYSPD OR -PIPYSPD)
0000162A  B07C 0078               1002              CMP.W   #120,D0
0000162E  6C00 000C               1003              BGE     .YPLUS              
00001632  317C FFFD 0006          1004              MOVE.W  #-PIPYSPD,6(A0)
00001638  6000 0008               1005              BRA     .END
0000163C  317C 0003 0006          1006  .YPLUS      MOVE.W  #PIPYSPD,6(A0)
00001642  301F                    1007  .END        MOVE.W  (A7)+,D0
00001644  4E75                    1008              RTS
00001646                          1009  
00001646                          1010  ; -----------------------------------------------------------------------------
00001646                          1011  PIPUPD
00001646                          1012  ; UPDATES AN ASTEROID
00001646                          1013  ; INPUT    - A0 POINTER TO THE LOCAL MEMORY
00001646                          1014  ; OUTPUT   - NONE
00001646                          1015  ; MODIFIES - NONE
00001646                          1016  ; -----------------------------------------------------------------------------
00001646  3F00                    1017              MOVE.W  D0,-(A7)
00001648  3028 0004               1018              MOVE.W  4(A0),D0                ; UPDATE COORDINATES
0000164C  9150                    1019              SUB.W   D0,(A0)
0000164E  0C50 FFC4               1020              CMP.W   #-PIPWIDTH,(A0)
00001652  6A00 0006               1021              BPL     .XPLUS                  ;KILL PIPES WHEN DISAPPEAR
00001656  6000 00B8               1022              BRA     .KILL
0000165A  3028 0006               1023  .XPLUS      MOVE.W  6(A0),D0
0000165E  D168 0002               1024              ADD.W   D0,2(A0)
00001662  4A68 0002               1025              TST.W   2(A0)
00001666  6F00 000C               1026              BLE     .BOUNCE
0000166A  0C68 0168 0002          1027              CMP.W   #SCRHEIGH-HOLHEIGH,2(A0) 
00001670  6D00 0006               1028              BLT     .CHKINPI
00001674  4468 0006               1029  .BOUNCE     NEG.W   6(A0)                   ; PIPE REACHES FLOOR/ROOF AND BOUNCES
00001678  3010                    1030  .CHKINPI    MOVE.W  (A0),D0
0000167A  0C68 0000 0008          1031              CMP.W   #0,8(A0)
00001680  6600 0024               1032              BNE     .COLPLAY
00001684  B079 000027C4           1033              CMP.W   (PLRPOSX),D0
0000168A  6E00 001A               1034              BGT     .COLPLAY
0000168E  0640 003C               1035              ADD.W   #PIPWIDTH,D0
00001692  B079 000027C4           1036              CMP.W   (PLRPOSX),D0
00001698  6500 000C               1037              BLO     .COLPLAY
0000169C  5A79 000027CA           1038              ADDQ.W  #5,(PLRSCORE)           ; ADD SCORE FOR PIPE
000016A2  5268 0008               1039              ADDQ.W  #1,8(A0)                ; SET SCORED
000016A6  3010                    1040  .COLPLAY    MOVE.W  (A0),D0
000016A8  4241                    1041              CLR.W   D1
000016AA  383C 003C               1042              MOVE.W  #PIPWIDTH,D4
000016AE  3C28 0002               1043              MOVE.W  2(A0),D6
000016B2  3439 000027C4           1044              MOVE.W  (PLRPOSX),D2
000016B8  3639 000027C6           1045              MOVE.W  (PLRPOSY),D3
000016BE  3A3C 001E               1046              MOVE.W  #PLRWIDTH,D5
000016C2  3E3C 001E               1047              MOVE.W  #PLRHEIGH,D7
000016C6  4EB8 125C               1048              JSR     UTLCHCOL                ;CHECK COLISION UPPER PIPE
000016CA  4A00                    1049              TST.B   D0
000016CC  6600 0036               1050              BNE     .DEATH
000016D0                          1051              
000016D0  3010                    1052              MOVE.W  (A0),D0
000016D2  3228 0002               1053              MOVE.W  2(A0),D1
000016D6  0641 0078               1054              ADD.W   #HOLHEIGH,D1
000016DA  383C 003C               1055              MOVE.W  #PIPWIDTH,D4
000016DE  3C3C 01E0               1056              MOVE.W  #SCRHEIGH,D6
000016E2  9C68 0002               1057              SUB.W   2(A0),D6
000016E6  3439 000027C4           1058              MOVE.W  (PLRPOSX),D2
000016EC  3639 000027C6           1059              MOVE.W  (PLRPOSY),D3
000016F2  3A3C 001E               1060              MOVE.W  #PLRWIDTH,D5
000016F6  3E3C 001E               1061              MOVE.W  #PLRHEIGH,D7
000016FA  4EB8 125C               1062              JSR     UTLCHCOL                ;CHECK COLISION WITH LOWER PIPE
000016FE                          1063  
000016FE  4A00                    1064              TST.B   D0
00001700  6700 000A               1065              BEQ     .END
00001704  13FC 0001 000027CC      1066  .DEATH      MOVE.B  #1,(PLRDEAD)
0000170C  301F                    1067  .END        MOVE.W  (A7)+,D0
0000170E  4E75                    1068              RTS
00001710  4EB8 123E               1069  .KILL       JSR     AGLKILL
00001714  6090                    1070              BRA     .COLPLAY
00001716                          1071  
00001716                          1072  
00001716                          1073  ; -----------------------------------------------------------------------------
00001716                          1074  PIPPLOT
00001716                          1075  ; PLOTS AN ASTEROID
00001716                          1076  ; INPUT    - A0 POINTER TO THE LOCAL MEMORY
00001716                          1077  ; OUTPUT   - NONE
00001716                          1078  ; MODIFIES - NONE
00001716                          1079  ; -----------------------------------------------------------------------------
00001716                          1080m             UTLSPEN #PIPPENCL
00001716                          1081m ; WRAPPER FOR SET PEN TRAP 15 TASK.
00001716                          1082m ; INPUT    - #PIPPENCL COLOR IN FORMAT $00BBGGRR
00001716                          1083m ; OUTPUT   - NONE
00001716                          1084m ; MODIFIES - D0,D1
00001716                          1085m ; -----------------------------------------------------------------------------
00001722                          1086m             UTLSFIL #PIPFILCL
00001722                          1087m ; WRAPPER FOR SET FIL TRAP 15 TASK.
00001722                          1088m ; INPUT    - #PIPFILCL COLOR IN FORMAT $00BBGGRR
00001722                          1089m ; OUTPUT   - NONE
00001722                          1090m ; MODIFIES - D0,D1
00001722                          1091m ; -----------------------------------------------------------------------------
0000172E  48A7 7800               1092              MOVEM.W D1-D4,-(A7)
00001732                          1093              ;UPPER PIPE
00001732  3210                    1094              MOVE.W  (A0),D1
00001734  4242                    1095              CLR.W   D2
00001736  3828 0002               1096              MOVE.W  2(A0),D4
0000173A  3601                    1097              MOVE.W  D1,D3
0000173C  0643 003C               1098              ADD.W   #PIPWIDTH,D3
00001740  103C 0057               1099              MOVE.B  #87,D0
00001744  4E4F                    1100              TRAP    #15
00001746                          1101              ;LOWER PIPE
00001746  3404                    1102              MOVE.W  D4,D2
00001748  0642 0078               1103              ADD.W   #HOLHEIGH,D2
0000174C  383C 01E0               1104              MOVE.W  #SCRHEIGH,D4
00001750  4E4F                    1105              TRAP    #15
00001752                          1106              ;UPPER PIPE LOWER EDGE
00001752  3210                    1107              MOVE.W  (A0),D1
00001754  5B41                    1108              SUB.W   #PIPEDGE,D1 
00001756  3428 0002               1109              MOVE.W  2(A0),D2
0000175A  5B42                    1110              SUB.W   #PIPEDGE,D2
0000175C  3828 0002               1111              MOVE.W  2(A0),D4
00001760  3610                    1112              MOVE.W  (A0),D3
00001762  5A43                    1113              ADD.W   #PIPEDGE,D3
00001764  0643 003C               1114              ADD.W   #PIPWIDTH,D3
00001768  4E4F                    1115              TRAP    #15
0000176A                          1116              ;LOWER PIPE UPPER EDGE
0000176A  0642 0078               1117              ADD.W    #HOLHEIGH,D2
0000176E  0644 0078               1118              ADD.W    #HOLHEIGH,D4
00001772  4E4F                    1119              TRAP    #15
00001774                          1120              
00001774  4C9F 001E               1121              MOVEM.W (A7)+,D1-D4
00001778  4E75                    1122              RTS
0000177A                          1123  
0000177A                          1124  
0000177A                          1125  
0000177A                          1126  
0000177A                          1127  
0000177A                          1128  
0000177A                          1129  
0000177A                          1130  
0000177A                          1131  -------------------- end include --------------------
0000177A                          1132              INCLUDE "COIN.X68"              ; SCORE-EARNING COINS MANAGEMENT
0000177A                          1133  ; =============================================================================
0000177A                          1134  ; COIN MANAGEMENT. IT IS AN AGENT.
0000177A                          1135  ; LOCAL MEMORY IS:
0000177A                          1136  ; +0 WORD X COORDINATE
0000177A                          1137  ; +2 WORD Y COORDINATE
0000177A                          1138  ; +4 WORD X SPEED
0000177A                          1139  ; +6 WORD Y SPEED
0000177A                          1140  ; =============================================================================
0000177A                          1141  
0000177A                          1142  ; -----------------------------------------------------------------------------
0000177A                          1143  COININIT
0000177A                          1144  ; INITALIZES A COIN
0000177A                          1145  ; INPUT    - A0 POINTER TO THE LOCAL MEMORY
0000177A                          1146  ; OUTPUT   - NONE
0000177A                          1147  ; MODIFIES - NONE
0000177A                          1148  ; NOTE     - ASSUMES SCRHEIGH IS GREATER THAN 255
0000177A                          1149  ; -----------------------------------------------------------------------------
0000177A  3F00                    1150              MOVE.W  D0,-(A7)
0000177C  4EB8 1290               1151              JSR     UTLRAND
00001780  30BC 0280               1152              MOVE.W  #SCRWIDTH,(A0)          ; X POSITION
00001784  3140 0002               1153              MOVE.W  D0,2(A0)                ; Y POSITION (PSEUDO-RANDOM)
00001788  317C 0005 0004          1154              MOVE.W  #COINXSPD,4(A0)         ; X SPEED: PIPXSPD (SAME AS PIPES)
0000178E  4268 0006               1155              CLR.W   6(A0)                   ; Y SPEED (0)
00001792  301F                    1156              MOVE.W  (A7)+,D0
00001794  4E75                    1157              RTS
00001796                          1158  
00001796                          1159  ; -----------------------------------------------------------------------------
00001796                          1160  COINUPD
00001796                          1161  ; UPDATES A COIN
00001796                          1162  ; INPUT    - A0 POINTER TO THE LOCAL MEMORY
00001796                          1163  ; OUTPUT   - NONE
00001796                          1164  ; MODIFIES - NONE
00001796                          1165  ; -----------------------------------------------------------------------------
00001796  3F00                    1166              MOVE.W  D0,-(A7)
00001798  3028 0004               1167              MOVE.W  4(A0),D0                ; UPDATE COORDINATES
0000179C  9150                    1168              SUB.W   D0,(A0)
0000179E  0C50 FFE7               1169              CMP.W   #-COINSIZE,(A0)
000017A2  6A00 0006               1170              BPL     .XPLUS                  ;KILL PIPES WHEN DISAPPEAR
000017A6  6000 0046               1171              BRA     .KILL
000017AA  3010                    1172  .XPLUS      MOVE.W  (A0),D0
000017AC  3228 0002               1173              MOVE.W  2(A0),D1
000017B0  383C 0019               1174              MOVE.W  #COINSIZE,D4
000017B4  3C04                    1175              MOVE.W  D4,D6
000017B6  3439 000027C4           1176              MOVE.W  (PLRPOSX),D2
000017BC  3639 000027C6           1177              MOVE.W  (PLRPOSY),D3
000017C2  3A3C 001E               1178              MOVE.W  #PLRWIDTH,D5
000017C6  3E3C 001E               1179              MOVE.W  #PLRHEIGH,D7
000017CA  4EB8 125C               1180              JSR     UTLCHCOL
000017CE  4A00                    1181              TST.B   D0
000017D0  6700 0018               1182              BEQ     .END
000017D4  0679 000A 000027CA      1183              ADD.W   #10,(PLRSCORE)
000017DC                          1184m             UTLSND  .COINSOU                ;PLAY COIN SOUND
000017DC                          1185m ; WRAPPER FOR PLAYING WAV FILE TRAP 15 TASK
000017DC                          1186m ; INPUT    - .COINSOU ADDRESS TO STRING WITH NAME OF THE FILE
000017DC                          1187m ; OUTPUT   - D0.W=0 IF SOUND NOT PLAYED, NON ZERO IF PLAYED
000017DC                          1188m ; MODIFIES - D0,A1
000017DC                          1189m ; -----------------------------------------------------------------------------
000017E2                          1190m             ;MOVE.L  #0,D1
000017E2                          1191m             ;MOVE.L  #0,D2
000017E6  6000 0006               1192              BRA     .KILL                   ;KILL AGENT
000017EA  301F                    1193  .END        MOVE.W  (A7)+,D0
000017EC  4E75                    1194              RTS
000017EE  4EB8 123E               1195  .KILL       JSR     AGLKILL
000017F2  60F6                    1196              BRA     .END
000017F4= 436F696E 2E776176 ...   1197  .COINSOU    DC.L    'Coin.wav',0            ; COIN SOUND
00001800                          1198  
00001800                          1199  ; -----------------------------------------------------------------------------
00001800                          1200  COINPLOT
00001800                          1201  ; PLOTS A COIN
00001800                          1202  ; INPUT    - A0 POINTER TO THE LOCAL MEMORY
00001800                          1203  ; OUTPUT   - NONE
00001800                          1204  ; MODIFIES - NONE
00001800                          1205  ; -----------------------------------------------------------------------------
00001800                          1206m             UTLSPEN #CNPENCL
00001800                          1207m ; WRAPPER FOR SET PEN TRAP 15 TASK.
00001800                          1208m ; INPUT    - #CNPENCL COLOR IN FORMAT $00BBGGRR
00001800                          1209m ; OUTPUT   - NONE
00001800                          1210m ; MODIFIES - D0,D1
00001800                          1211m ; -----------------------------------------------------------------------------
00001808                          1212m             UTLSFIL #CNFILCL
00001808                          1213m ; WRAPPER FOR SET FIL TRAP 15 TASK.
00001808                          1214m ; INPUT    - #CNFILCL COLOR IN FORMAT $00BBGGRR
00001808                          1215m ; OUTPUT   - NONE
00001808                          1216m ; MODIFIES - D0,D1
00001808                          1217m ; -----------------------------------------------------------------------------
00001814  48A7 7800               1218              MOVEM.W D1-D4,-(A7)
00001818  3210                    1219              MOVE.W  (A0),D1
0000181A  3428 0002               1220              MOVE.W  2(A0),D2
0000181E  3601                    1221              MOVE.W  D1,D3
00001820  3802                    1222              MOVE.W  D2,D4
00001822  0643 0019               1223              ADD.W   #COINSIZE,D3
00001826  0644 0019               1224              ADD.W   #COINSIZE,D4
0000182A  103C 0058               1225              MOVE.B  #88,D0
0000182E  4E4F                    1226              TRAP    #15
00001830  4C9F 001E               1227              MOVEM.W (A7)+,D1-D4
00001834  4E75                    1228              RTS
00001836                          1229  
00001836                          1230  
00001836                          1231  
00001836                          1232  
00001836                          1233  
00001836                          1234  -------------------- end include --------------------
00001836                          1235              INCLUDE "SPAWNER.X68"           ; SPAWNER (CREATES ASTEROIDS)
00001836                          1236  ; =============================================================================
00001836                          1237  ; SPAWNER MANAGEMENT.
00001836                          1238  ; =============================================================================
00001836                          1239  
00001836                          1240  ; -----------------------------------------------------------------------------
00001836                          1241  SPWUPD
00001836                          1242  ; UPDATES THE SPAWNER
00001836                          1243  ; INPUT    - NONE
00001836                          1244  ; OUTPUT   - NONE
00001836                          1245  ; MODIFIES - NONE
00001836                          1246  ; -----------------------------------------------------------------------------
00001836  48E7 8070               1247              MOVEM.L D0/A1-A3,-(A7)
0000183A                          1248              ;SPAWN COINS
0000183A  1039 00001ADD           1249              MOVE.B  (SCRCYCCT),D0
00001840  C07C 001F               1250              AND     #$1F,D0                 ; EVERY 32 CYCLES
00001844  6600 0016               1251              BNE     .PIPES
00001848  43F8 177A               1252              LEA     COININIT,A1
0000184C  45F8 1796               1253              LEA     COINUPD,A2
00001850  47F8 1800               1254              LEA     COINPLOT,A3
00001854  303C 0004               1255              MOVE.W  #COINTYPE,D0
00001858  4EB8 1558               1256              JSR     AGLADD
0000185C                          1257              ;SPAWN PIPES
0000185C  1039 00001ADD           1258  .PIPES      MOVE.B  (SCRCYCCT),D0
00001862  C07C 003F               1259              AND     #$3F,D0                 ; EVERY 64 CYCLES
00001866  6600 0016               1260              BNE     .END
0000186A  43F8 15BC               1261              LEA     PIPINIT,A1
0000186E  45F8 1646               1262              LEA     PIPUPD,A2
00001872  47F8 1716               1263              LEA     PIPPLOT,A3
00001876  303C 0002               1264              MOVE.W  #ASTTYPE,D0
0000187A  4EB8 1558               1265              JSR     AGLADD
0000187E  4CDF 0E01               1266  .END        MOVEM.L (A7)+,D0/A1-A3
00001882  4E75                    1267              RTS
00001884                          1268  
00001884                          1269  
00001884                          1270  
00001884                          1271  
00001884                          1272  
00001884                          1273  -------------------- end include --------------------
00001884                          1274              INCLUDE "STATES.X68"            ; GAME STATES MANAGEMENT
00001884                          1275  ; =============================================================================
00001884                          1276  ; GAME STATE MANAGEMENT
00001884                          1277  ; =============================================================================
00001884                          1278  
00001884                          1279  ; -----------------------------------------------------------------------------
00001884                          1280  STAINIT
00001884                          1281  ; INITALIZES THE STATE MANAGER
00001884                          1282  ; INPUT    - NONE
00001884                          1283  ; OUTPUT   - NONE
00001884                          1284  ; MODIFIES - NONE
00001884                          1285  ; -----------------------------------------------------------------------------
00001884  33FC FFFF 000027C0      1286              MOVE.W  #STANONE,(STACUR)
0000188C  33FC 0000 000027C2      1287              MOVE.W  #STAINTR,(STANEXT)
00001894  4E75                    1288              RTS
00001896                          1289  
00001896                          1290  ; -----------------------------------------------------------------------------
00001896                          1291  STAUPD
00001896                          1292  ; PERFORMS STATE UPDATE AND INIT IF NECESSARY
00001896                          1293  ; INPUT    - NONE
00001896                          1294  ; OUTPUT   - NONE
00001896                          1295  ; MODIFIES - NONE
00001896                          1296  ; -----------------------------------------------------------------------------
00001896  48E7 8080               1297              MOVEM.L D0/A0,-(A7)
0000189A  701E                    1298              MOVEQ   #30,D0     ;RESET THE CYCLE COUNTER
0000189C  4E4F                    1299              TRAP    #15
0000189E  4280                    1300              CLR.L   D0
000018A0  3039 000027C2           1301              MOVE.W  (STANEXT),D0
000018A6  B079 000027C0           1302              CMP.W   (STACUR),D0
000018AC  6700 0012               1303              BEQ     .DOUPD
000018B0  33C0 000027C0           1304              MOVE.W  D0,(STACUR)             ; IF STATE CHANGED, DO INIT
000018B6  E588                    1305              LSL.L   #2,D0
000018B8  2040                    1306              MOVE.L  D0,A0
000018BA  2068 18E2               1307              MOVE.L  .INITBL(A0),A0
000018BE  4E90                    1308              JSR     (A0)
000018C0  4280                    1309  .DOUPD      CLR.L   D0                      ; IN ANY CASE, DO UPDATE
000018C2  3039 000027C0           1310              MOVE.W  (STACUR),D0
000018C8  E588                    1311              LSL.L   #2,D0
000018CA  2040                    1312              MOVE.L  D0,A0
000018CC  2068 18EE               1313              MOVE.L  .UPDTBL(A0),A0
000018D0  4E90                    1314              JSR     (A0)
000018D2  701F                    1315              MOVEQ   #31,D0                 ;GET NUMBER OF CYCLES IN PLOT
000018D4  4E4F                    1316              TRAP    #15
000018D6  33C1 000027CE           1317              MOVE    D1,(CYCLEUPD)          ;SAVE THE RESULT
000018DC  4CDF 0101               1318              MOVEM.L (A7)+,D0/A0
000018E0  4E75                    1319              RTS
000018E2= 00001192 000013AE ...   1320  .INITBL     DC.L    STAINTRI,STAPLAYI,STAEMPTY
000018EE= 0000194C 00001932 ...   1321  .UPDTBL     DC.L    STAINTRU,STAPLAYU,STAGOVRU
000018FA                          1322  
000018FA                          1323  ; -----------------------------------------------------------------------------
000018FA                          1324  STAPLOT
000018FA                          1325  ; PERFORMS STATE PLOT
000018FA                          1326  ; INPUT    - NONE
000018FA                          1327  ; OUTPUT   - NONE
000018FA                          1328  ; MODIFIES - NONE
000018FA                          1329  ; -----------------------------------------------------------------------------
000018FA  48E7 8080               1330              MOVEM.L D0/A0,-(A7)
000018FE  701E                    1331              MOVEQ   #30,D0                 ;RESET THE CYCLE COUNTER
00001900  4E4F                    1332              TRAP    #15
00001902  4280                    1333              CLR.L   D0
00001904  3039 000027C0           1334              MOVE.W  (STACUR),D0
0000190A  E588                    1335              LSL.L   #2,D0
0000190C  2040                    1336              MOVE.L  D0,A0
0000190E  2068 1924               1337              MOVE.L  .PLTTBL(A0),A0
00001912  4E90                    1338              JSR     (A0)
00001914  701F                    1339              MOVEQ   #31,D0                 ;GET NUMBER OF CYCLES IN PLOT
00001916  4E4F                    1340              TRAP    #15
00001918  33C1 000027D2           1341              MOVE    D1,(CYCLEPLT)          ;SAVE THE RESULT
0000191E  4CDF 0101               1342              MOVEM.L (A7)+,D0/A0
00001922  4E75                    1343              RTS
00001924= 00001962 0000193E ...   1344  .PLTTBL     DC.L    STAINTRP,STAPLAYP,STAGOVRP
00001930                          1345  
00001930                          1346  ; -----------------------------------------------------------------------------
00001930                          1347  STAEMPTY
00001930                          1348  ; EMPTY SUBROUTINE FOR CASES WITH NOTHING TO DO
00001930                          1349  ; INPUT    - NONE
00001930                          1350  ; OUTPUT   - NONE
00001930                          1351  ; MODIFIES - NONE
00001930                          1352  ; NOTE     - JUST A PLACEHOLDER. NOTHING TO DO.
00001930                          1353  ; -----------------------------------------------------------------------------
00001930  4E75                    1354              RTS
00001932                          1355  
00001932                          1356  ; -----------------------------------------------------------------------------
00001932  =000013AE               1357  STAPLAYI    EQU     PLRINIT
00001932                          1358  ; PLAY STATE INITIALIZATION.
00001932                          1359  ; INPUT    - NONE
00001932                          1360  ; OUTPUT   - NONE
00001932                          1361  ; MODIFIES - NONE
00001932                          1362  ; NOTE     - JUST A WRAPPER FOR PLRINIT
00001932                          1363  ; -----------------------------------------------------------------------------
00001932                          1364  
00001932                          1365  ; -----------------------------------------------------------------------------
00001932                          1366  STAPLAYU
00001932                          1367  ; PLAY STATE UPDATE
00001932                          1368  ; INPUT    - NONE
00001932                          1369  ; OUTPUT   - NONE
00001932                          1370  ; MODIFIES - NONE
00001932                          1371  ; -----------------------------------------------------------------------------
00001932  4EB8 13D6               1372              JSR     PLRUPD
00001936  4EB8 1836               1373              JSR     SPWUPD
0000193A  6000 FC36               1374              BRA     AGLUPD
0000193E                          1375  
0000193E                          1376  ; -----------------------------------------------------------------------------
0000193E                          1377  STAPLAYP
0000193E                          1378  ; PLAY STATE PLOT
0000193E                          1379  ; INPUT    - NONE
0000193E                          1380  ; OUTPUT   - NONE
0000193E                          1381  ; MODIFIES - NONE
0000193E                          1382  ; -----------------------------------------------------------------------------
0000193E  4EB9 00001A82           1383              JSR     BACKGPLOT
00001944  4EB8 1596               1384              JSR     AGLPLOT
00001948  6000 FB5A               1385              BRA     PLRPLOT
0000194C                          1386  
0000194C                          1387  ; -----------------------------------------------------------------------------
0000194C  =00001192               1388  STAINTRI    EQU     DMMINIT
0000194C                          1389  ; INTRO STATE INIT
0000194C                          1390  ; INPUT    - NONE
0000194C                          1391  ; OUTPUT   - NONE
0000194C                          1392  ; MODIFIES - NONE
0000194C                          1393  ; NOTE     - JUST A WRAPPER FOR DMMINIT TO RELEASE ALL MEMORY
0000194C                          1394  ; -----------------------------------------------------------------------------
0000194C                          1395  
0000194C                          1396  ; -----------------------------------------------------------------------------
0000194C                          1397  STAINTRU
0000194C                          1398  ; INTRO STATE UPDATE
0000194C                          1399  ; INPUT    - NONE
0000194C                          1400  ; OUTPUT   - NONE
0000194C                          1401  ; MODIFIES - NONE
0000194C                          1402  ; -----------------------------------------------------------------------------
0000194C  0839 0004 00001ADB      1403              BTST.B  #KBDBITF1,(KBDEDGE)
00001954  6700 000A               1404              BEQ     .END
00001958  33FC 0001 000027C2      1405              MOVE.W  #STAPLAY,(STANEXT)
00001960  4E75                    1406  .END        RTS
00001962                          1407  
00001962                          1408  ; -----------------------------------------------------------------------------
00001962                          1409  STAINTRP
00001962                          1410  ; INTRO STATE PLOT
00001962                          1411  ; INPUT    - NONE
00001962                          1412  ; OUTPUT   - NONE
00001962                          1413  ; MODIFIES - NONE
00001962                          1414  ; -----------------------------------------------------------------------------
00001962  48E7 C040               1415              MOVEM.L A1/D0-D1,-(A7)
00001966                          1416m             UTLLOCT INTTITX,INTTITY
00001966                          1417m ; WRAPPER TO TEXT POSITIONNING FROM TRAP 15
00001966                          1418m ; INPUT    - INTTITX X, INTTITY Y
00001966                          1419m ; OUTPUT   - NONE
00001966                          1420m ; MODIFIES - D0,D1
00001966                          1421m ; -----------------------------------------------------------------------------
00001970                          1422m             UTLSPEN #INTTITC
00001970                          1423m ; WRAPPER FOR SET PEN TRAP 15 TASK.
00001970                          1424m ; INPUT    - #INTTITC COLOR IN FORMAT $00BBGGRR
00001970                          1425m ; OUTPUT   - NONE
00001970                          1426m ; MODIFIES - D0,D1
00001970                          1427m ; -----------------------------------------------------------------------------
0000197C                          1428m             UTLSFIL #$00000000
0000197C                          1429m ; WRAPPER FOR SET FIL TRAP 15 TASK.
0000197C                          1430m ; INPUT    - #$00000000 COLOR IN FORMAT $00BBGGRR
0000197C                          1431m ; OUTPUT   - NONE
0000197C                          1432m ; MODIFIES - D0,D1
0000197C                          1433m ; -----------------------------------------------------------------------------
00001984  43F9 000019C0           1434              LEA     .TITSTR,A1
0000198A  103C 000E               1435              MOVE.B  #14,D0
0000198E  4E4F                    1436              TRAP    #15
00001990                          1437  
00001990                          1438m             UTLLOCT INTPRSX,INTPRSY
00001990                          1439m ; WRAPPER TO TEXT POSITIONNING FROM TRAP 15
00001990                          1440m ; INPUT    - INTPRSX X, INTPRSY Y
00001990                          1441m ; OUTPUT   - NONE
00001990                          1442m ; MODIFIES - D0,D1
00001990                          1443m ; -----------------------------------------------------------------------------
0000199A                          1444m             UTLSPEN #INTPRSC
0000199A                          1445m ; WRAPPER FOR SET PEN TRAP 15 TASK.
0000199A                          1446m ; INPUT    - #INTPRSC COLOR IN FORMAT $00BBGGRR
0000199A                          1447m ; OUTPUT   - NONE
0000199A                          1448m ; MODIFIES - D0,D1
0000199A                          1449m ; -----------------------------------------------------------------------------
000019A6                          1450m             UTLSFIL #$00000000
000019A6                          1451m ; WRAPPER FOR SET FIL TRAP 15 TASK.
000019A6                          1452m ; INPUT    - #$00000000 COLOR IN FORMAT $00BBGGRR
000019A6                          1453m ; OUTPUT   - NONE
000019A6                          1454m ; MODIFIES - D0,D1
000019A6                          1455m ; -----------------------------------------------------------------------------
000019AE  43F9 000019E5           1456              LEA     .PRSSTR,A1
000019B4  103C 000E               1457              MOVE.B  #14,D0
000019B8  4E4F                    1458              TRAP    #15
000019BA  4CDF 0203               1459              MOVEM.L (A7)+,A1/D0-D1
000019BE  4E75                    1460              RTS
000019C0                          1461  
000019C0= 56 45 52 59 20 44 ...   1462  .TITSTR     DC.B    'VERY DIFFERENT GAME FROM FLAPPY BIRD',0
000019E5= 50 55 53 48 20 53 ...   1463  .PRSSTR     DC.B    'PUSH SPACE BAR TO START',0
000019FE                          1464              DS.W    0
000019FE                          1465  
000019FE                          1466  ; -----------------------------------------------------------------------------
000019FE                          1467  STAGOVRU
000019FE                          1468  ; GAME OVER STATE UPDATE
000019FE                          1469  ; INPUT    - NONE
000019FE                          1470  ; OUTPUT   - NONE
000019FE                          1471  ; MODIFIES - NONE
000019FE                          1472  ; -----------------------------------------------------------------------------
000019FE  0839 0004 00001ADB      1473              BTST.B  #KBDBITF1,(KBDEDGE)
00001A06  6700 000A               1474              BEQ     .END
00001A0A  33FC 0000 000027C2      1475              MOVE.W  #STAINTR,(STANEXT)
00001A12  4E75                    1476  .END        RTS
00001A14                          1477  
00001A14                          1478  ; -----------------------------------------------------------------------------
00001A14                          1479  STAGOVRP
00001A14                          1480  ; GAME OVER STATE PLOT
00001A14                          1481  ; INPUT    - NONE
00001A14                          1482  ; OUTPUT   - NONE
00001A14                          1483  ; MODIFIES - NONE
00001A14                          1484  ; -----------------------------------------------------------------------------
00001A14                          1485              ;PLOT GAME OVER STRING
00001A14  48E7 C040               1486              MOVEM.L A1/D0-D1,-(A7)
00001A18                          1487m             UTLLOCT GOVSTRX,GOVSTRY
00001A18                          1488m ; WRAPPER TO TEXT POSITIONNING FROM TRAP 15
00001A18                          1489m ; INPUT    - GOVSTRX X, GOVSTRY Y
00001A18                          1490m ; OUTPUT   - NONE
00001A18                          1491m ; MODIFIES - D0,D1
00001A18                          1492m ; -----------------------------------------------------------------------------
00001A22                          1493m             UTLSPEN #GOVSTRC
00001A22                          1494m ; WRAPPER FOR SET PEN TRAP 15 TASK.
00001A22                          1495m ; INPUT    - #GOVSTRC COLOR IN FORMAT $00BBGGRR
00001A22                          1496m ; OUTPUT   - NONE
00001A22                          1497m ; MODIFIES - D0,D1
00001A22                          1498m ; -----------------------------------------------------------------------------
00001A2E                          1499m             UTLSFIL #$00000000
00001A2E                          1500m ; WRAPPER FOR SET FIL TRAP 15 TASK.
00001A2E                          1501m ; INPUT    - #$00000000 COLOR IN FORMAT $00BBGGRR
00001A2E                          1502m ; OUTPUT   - NONE
00001A2E                          1503m ; MODIFIES - D0,D1
00001A2E                          1504m ; -----------------------------------------------------------------------------
00001A36  43F9 00001A70           1505              LEA     .GOVSTR,A1
00001A3C  103C 000E               1506              MOVE.B  #14,D0
00001A40  4E4F                    1507              TRAP    #15
00001A42                          1508              ;PLOT SCORE STRING
00001A42                          1509m             UTLLOCT GOVSTRX,GOVSTRY+2
00001A42                          1510m ; WRAPPER TO TEXT POSITIONNING FROM TRAP 15
00001A42                          1511m ; INPUT    - GOVSTRX X, GOVSTRY+2 Y
00001A42                          1512m ; OUTPUT   - NONE
00001A42                          1513m ; MODIFIES - D0,D1
00001A42                          1514m ; -----------------------------------------------------------------------------
00001A4C  103C 000E               1515              MOVE.B  #14,D0
00001A50  43F9 00001A7B           1516              LEA     .SCOSTR,A1
00001A56  4E4F                    1517              TRAP    #15
00001A58                          1518              ;PLOT SCORE NUMBER
00001A58  3239 000027CA           1519              MOVE.W  (PLRSCORE),D1
00001A5E  48C1                    1520              EXT.L   D1
00001A60  143C 000A               1521              MOVE.B  #10,D2
00001A64  103C 000F               1522              MOVE.B  #15,D0
00001A68  4E4F                    1523              TRAP    #15
00001A6A                          1524              
00001A6A  4CDF 0203               1525              MOVEM.L (A7)+,A1/D0-D1
00001A6E  4E75                    1526              RTS
00001A70                          1527  
00001A70= 47 41 4D 45 20 20 ...   1528  .GOVSTR     DC.B    'GAME  OVER',0
00001A7B= 53 43 4F 52 45 3A 00    1529  .SCOSTR     DC.B    'SCORE:',0
00001A82                          1530              DS.W    0
00001A82                          1531  
00001A82                          1532  -------------------- end include --------------------
00001A82                          1533              INCLUDE "BACKGROUND.X68"        ; GAME BACKGROUND MANAGEMENT
00001A82                          1534  ;------------------------------------------------------------------------------
00001A82                          1535  ; BACKGROUND
00001A82                          1536  ;------------------------------------------------------------------------------
00001A82                          1537  
00001A82                          1538  ; -----------------------------------------------------------------------------
00001A82                          1539  BACKGPLOT
00001A82                          1540  ; PLOTS BACKGROUND
00001A82                          1541  ; INPUT    - NONE
00001A82                          1542  ; OUTPUT   - NONE
00001A82                          1543  ; MODIFIES - NONE
00001A82                          1544  ; -----------------------------------------------------------------------------
00001A82                          1545m             UTLSPEN #$00000000
00001A82                          1546m ; WRAPPER FOR SET PEN TRAP 15 TASK.
00001A82                          1547m ; INPUT    - #$00000000 COLOR IN FORMAT $00BBGGRR
00001A82                          1548m ; OUTPUT   - NONE
00001A82                          1549m ; MODIFIES - D0,D1
00001A82                          1550m ; -----------------------------------------------------------------------------
00001A8A                          1551m             UTLSFIL #$00EFCE87
00001A8A                          1552m ; WRAPPER FOR SET FIL TRAP 15 TASK.
00001A8A                          1553m ; INPUT    - #$00EFCE87 COLOR IN FORMAT $00BBGGRR
00001A8A                          1554m ; OUTPUT   - NONE
00001A8A                          1555m ; MODIFIES - D0,D1
00001A8A                          1556m ; -----------------------------------------------------------------------------
00001A96  48A7 7800               1557              MOVEM.W D1-D4,-(A7)
00001A9A  4241                    1558              CLR.W   D1
00001A9C  4242                    1559              CLR.W   D2
00001A9E  383C 01E0               1560              MOVE.W  #SCRHEIGH,D4
00001AA2  363C 0280               1561              MOVE.W  #SCRWIDTH,D3
00001AA6  103C 0057               1562              MOVE.B  #87,D0
00001AAA  4E4F                    1563              TRAP    #15
00001AAC                          1564              
00001AAC  4C9F 001E               1565              MOVEM.W (A7)+,D1-D4
00001AB0  4E75                    1566              RTS
00001AB0  4E75                    1567  -------------------- end include --------------------
00001AB2                          1568  
00001AB2                          1569  ; --- INITIALIZE --------------------------------------------------------------
00001AB2                          1570  
00001AB2  4EB8 1000               1571  START       JSR     SYSINIT                 ; INITIALIZE SYSTEM CODE
00001AB6  4EB8 1884               1572              JSR     STAINIT                 ; INITIALIZE GAME STATE
00001ABA                          1573  
00001ABA                          1574  ; --- UPDATE ------------------------------------------------------------------
00001ABA                          1575  
00001ABA  4E40                    1576  .LOOP       TRAP    #KBDTRAP                ; READ KEYBOARD
00001ABC  4EB8 1896               1577              JSR     STAUPD                  ; UPDATE DEPENDING ON THE STATE
00001AC0                          1578  
00001AC0                          1579  ; --- WAIT SYNCH --------------------------------------------------------------
00001AC0                          1580  
00001AC0  4A39 00001ADC           1581  .WINT       TST.B   (SCRINTCT)              ; WAIT FOR INTERRUPT
00001AC6  67F8                    1582              BEQ     .WINT
00001AC8  4239 00001ADC           1583              CLR.B   (SCRINTCT)
00001ACE                          1584  
00001ACE                          1585  ; --- PLOT --------------------------------------------------------------------
00001ACE                          1586  
00001ACE  4EB8 18FA               1587              JSR     STAPLOT                 ; PLOT DEPENDING ON THE STATE
00001AD2  4E41                    1588              TRAP    #SCRTRAP                ; SHOW GRAPHICS
00001AD4  60E4                    1589              BRA     .LOOP
00001AD6  FFFF FFFF               1590              SIMHALT
00001ADA                          1591  
00001ADA                          1592  ; --- VARIABLES ---------------------------------------------------------------
00001ADA                          1593  
00001ADA                          1594              INCLUDE "SYSVAR.X68"
00001ADA                          1595  ; =============================================================================
00001ADA                          1596  ; SYSTEM VARS
00001ADA                          1597  ; NOTE THAT ALL THESE VARS ARE USED TO SHARE DATA FROM SYSTEM TO USER. THUS
00001ADA                          1598  ; THEY MUST NOT BE IN PROTECTED MEMORY.
00001ADA                          1599  ; NOTE THAT USING DMMDATA IN SUCH WAY IS A BAD IDEA, AS USER APPLICATIONS CAN
00001ADA                          1600  ; ALSO FREE OR CHANGE OWNERSHIP. NONETHELESS, FOR THE SAKE OF THIS EXAMPLE
00001ADA                          1601  ; THIS IS GOOD ENOUGH.
00001ADA                          1602  ; =============================================================================
00001ADA                          1603  
00001ADA                          1604  ; --- KEYBOARD RELATED VARIABLES ----------------------------------------------
00001ADA                          1605  
00001ADA                          1606  KBDVAL      DS.B    1                       ; KEY PRESSED=1
00001ADB                          1607  KBDEDGE     DS.B    1                       ; KEY CHANGED=1
00001ADC                          1608  
00001ADC                          1609              DS.W    0
00001ADC                          1610  
00001ADC                          1611  ; --- SCREEN RELATED VARIABLES ------------------------------------------------
00001ADC                          1612  
00001ADC                          1613  SCRINTCT    DS.B    1                       ; INTERRUPT COUNTER/FLAG
00001ADD                          1614  SCRCYCCT    DS.B    50                      ; CYCLE COUNTER
00001B10                          1615              DS.W    0
00001B10                          1616  
00001B10                          1617  ; --- DYNAMIC MEMORY VARIABLES ------------------------------------------------
00001B10                          1618  
00001B40                          1619              ORG     (*+DMMBSIZE-1)&-DMMBSIZE ; ALIGN TO DMMBSIZE
00001B40                          1620  DMMDATA     DS.B    DMMBSIZE*DMMBNUM        ; DYNAMIC MEMORY ALLOCATION SPACE
000027C0                          1621              DS.W    0                       ; JUST IN CASE (SIZE IS POW OF TWO)
000027C0                          1622  
000027C0                          1623  
000027C0                          1624  
000027C0                          1625  
000027C0                          1626  -------------------- end include --------------------
000027C0                          1627              INCLUDE "VAR.X68"
000027C0                          1628  ; =============================================================================
000027C0                          1629  ; GAME VARS
000027C0                          1630  ; =============================================================================
000027C0                          1631  
000027C0                          1632  ; --- GAME STATE RELATED VARIABLES --------------------------------------------
000027C0                          1633  
000027C0                          1634  STACUR      DS.W    1                       ; CURRENT GAME STATE
000027C2                          1635  STANEXT     DS.W    1                       ; NEXT GAME STATE
000027C4                          1636  
000027C4                          1637  ; --- PLAYER RELATED VARIABLES ------------------------------------------------
000027C4                          1638  
000027C4                          1639  PLRPOSX     DS.W    1                       ; PLAYER X POSITION (PIXELS)
000027C6                          1640  PLRPOSY     DS.W    1                       ; PLAYER Y POSITION (PIXELS)
000027C8                          1641  PLRSPDY     DS.W    1                       ; PLAYER Y SPEED (PIXELS/FRAME)
000027CA                          1642  PLRSCORE    DS.W    1                       ; PLAYER SCORE
000027CC                          1643  PLRDEAD     DS.B    1                       ; BIT0: UPD DAMAGE, BIT1 PLOT DMG
000027CE                          1644              DS.W    0
000027CE                          1645              
000027CE                          1646  ; --- CYCLE COUNTERS ---------------------------------------------------------
000027CE                          1647  
000027CE                          1648  CYCLEUPD    DS.L    1                       ;NUMBER OF CYCLES OF INTERRUPTIONS
000027D2                          1649  CYCLEPLT    DS.L    1                       ;NUMBER OF CYCLES OF DRAWING
000027D6                          1650  
000027D6                          1651  ; --- UTILITY VARIABLES ------------------------------------------------------
000027D6                          1652  
000027D6                          1653  UTLRNDIX    DS.B    1                       ; NEXT INDEX TO RANDOM NUMBER
000027D8                          1654              DS.W    0
000027D8                          1655              
000027D8                          1656  ; --- GAME COUNTERS ----------------------------------------------------------
000027D8                          1657  
000027D8                          1658  PIPCOUNT    DS.W    1
000027DA                          1659  
000027DA                          1660  
000027DA                          1661  
000027DA                          1662  
000027DA                          1663  
000027DA                          1664  
000027DA                          1665  
000027DA                          1666  
000027DA                          1667  -------------------- end include --------------------
000027DA                          1668              END    START

No errors detected
No warnings generated


SYMBOL TABLE INFORMATION
Symbol-name         Value
-------------------------
AGLADD              1558
AGLADD:END          156E
AGLKILL             123E
AGLPLOT             1596
AGLPLOT:END         15B6
AGLPLOT:LOOP        159E
AGLUPD              1572
AGLUPD:END          1590
AGLUPD:LOOP         157A
ASTTYPE             2
BACKGPLOT           1A82
CNFILCL             FFFF
CNPENCL             0
COININIT            177A
COINPLOT            1800
COINSIZE            19
COINTYPE            4
COINUPD             1796
COINUPD:COINSOU     17F4
COINUPD:END         17EA
COINUPD:KILL        17EE
COINUPD:XPLUS       17AA
COINXSPD            5
CYCLEPLT            27D2
CYCLEUPD            27CE
DMMALLOC            1224
DMMALLOC:END        123C
DMMBNUM             32
DMMBSIZE            40
DMMDATA             1B40
DMMFCOM             11FE
DMMFFND             120C
DMMFIRST            11B4
DMMFLOOP            11F2
DMMFRCOM            11C6
DMMFREE             123E
DMMFRFND            11D4
DMMFRLOP            11BA
DMMFRSTO            11EC
DMMINIT             1192
DMMINIT:LOOP        11A0
DMMNEXT             11D6
DMMNEXTO            120E
DMMSYSID            0
GOVSTRC             FFFFFF
GOVSTRX             23
GOVSTRY             F
HOLHEIGH            78
INTPRSC             FFFFFF
INTPRSX             1F
INTPRSY             17
INTTITC             FF
INTTITX             19
INTTITY             5
KBDBITDN            3
KBDBITF1            4
KBDBITF2            5
KBDBITF3            6
KBDBITLF            0
KBDBITPS            7
KBDBITRT            2
KBDBITUP            1
KBDCHRDN            28
KBDCHRLF            25
KBDCHRMK            4D
KBDCHRPK            50
KBDCHRRT            27
KBDCHRSH            10
KBDCHRSP            20
KBDCHRUP            26
KBDDOWN             28
KBDEDGE             1ADB
KBDFIRE1            20
KBDFIRE2            4D
KBDFIRE3            10
KBDINIT             10A2
KBDLEFT             25
KBDMSKDN            8
KBDMSKF1            10
KBDMSKF2            20
KBDMSKF3            40
KBDMSKLF            1
KBDMSKPS            80
KBDMSKRT            4
KBDMSKUP            2
KBDPAUSE            50
KBDREAD             10B8
KBDREAD:COND1       10EA
KBDREAD:COND2       10FE
KBDREAD:COND3       1112
KBDREAD:COND4       1126
KBDREAD:COND5       113A
KBDREAD:COND6       114E
KBDREAD:COND7       1162
KBDREAD:FINISH      1176
KBDREAD:KBDDOWN     1122
KBDREAD:KBDF1       1136
KBDREAD:KBDF2       114A
KBDREAD:KBDF3       115E
KBDREAD:KBDLEFT     10E6
KBDREAD:KBDP        1172
KBDREAD:KBDRT       110E
KBDREAD:KBDUP       10FA
KBDRIGHT            27
KBDTRAP             0
KBDUP               26
KBDVAL              1ADA
PIPCOUNT            27D8
PIPEDGE             5
PIPFILCL            8000
PIPINIT             15BC
PIPINIT:EASY        160C
PIPINIT:END         1642
PIPINIT:YMOVE       1626
PIPINIT:YNOTMOV     161C
PIPINIT:YPLUS       163C
PIPPENCL            FFFFFF
PIPPLOT             1716
PIPSCORE            5
PIPUPD              1646
PIPUPD:BOUNCE       1674
PIPUPD:CHKINPI      1678
PIPUPD:COLPLAY      16A6
PIPUPD:DEATH        1704
PIPUPD:END          170C
PIPUPD:KILL         1710
PIPUPD:XPLUS        165A
PIPWIDTH            3C
PIPXSPD             5
PIPYSPD             3
PLRACCY             1
PLRCOLOR            FF
PLRDEAD             27CC
PLRHEIGH            1E
PLRINIT             13AE
PLRPLOT             14A4
PLRPLOT:SCORESTR    1550
PLRPOSX             27C4
PLRPOSY             27C6
PLRSCORE            27CA
PLRSPDX             5
PLRSPDY             27C8
PLRTXTCL            FFFFFF
PLRTXTX             2
PLRTXTY             1
PLRUPD              13D6
PLRUPD:BOUNDUP      13F0
PLRUPD:BOUNDWN      13FC
PLRUPD:CHKRT        146C
PLRUPD:CHKUP        1452
PLRUPD:DEATH        141A
PLRUPD:EXPSOUN      1490
PLRUPD:MDONE        148C
PLRUPD:NOTOUCH      142C
PLRWIDTH            1E
SCRCYCCT            1ADD
SCRHEIGH            1E0
SCRINIT             101C
SCRINTCT            1ADC
SCRIRQ              1
SCRISR              107E
SCRTIM              14
SCRTRAP             1
SCRUPD              108C
SCRWIDTH            280
SHTTYPE             1
SPWUPD              1836
SPWUPD:END          187E
SPWUPD:PIPES        185C
STACUR              27C0
STAEMPTY            1930
STAGOVR             2
STAGOVRP            1A14
STAGOVRP:GOVSTR     1A70
STAGOVRP:SCOSTR     1A7B
STAGOVRU            19FE
STAGOVRU:END        1A12
STAINIT             1884
STAINTR             0
STAINTRI            1192
STAINTRP            1962
STAINTRP:PRSSTR     19E5
STAINTRP:TITSTR     19C0
STAINTRU            194C
STAINTRU:END        1960
STANEXT             27C2
STANONE             FFFFFFFF
STAPLAY             1
STAPLAYI            13AE
STAPLAYP            193E
STAPLAYU            1932
STAPLOT             18FA
STAPLOT:PLTTBL      1924
START               1AB2
START:LOOP          1ABA
START:WINT          1AC0
STAUPD              1896
STAUPD:DOUPD        18C0
STAUPD:INITBL       18E2
STAUPD:UPDTBL       18EE
SYSINIT             1000
UTLCHCOL            125C
UTLCHCOL:END        128A
UTLCHCOL:NOCOL      1288
UTLINIT             1254
UTLLOCT             254
UTLRAND             1290
UTLRAND:RANDVEC     12AE
UTLRNDIX            27D6
UTLSFIL             12A
UTLSND              37C
UTLSPEN             0
XPLTYPE             3
